<?php
    //This is generated by Swapp Software Application on 18/10/2018 07:13:38 PM for PHP
    require("../info/phpgetloginview.php");
    include("../info/ncryptdcrypt.php");
    require("../info/routine.php");
    include("../ip_model/saleheader_db_oracle.php");
    $connection=petrolpump_connection();
    $saleheader1 = new saleheader($connection);
    $saleheader1->entityglobalgroupid = $_POST["entityglobalgroupid"];
    $saleheader1->yearperiodcode = $_POST["yearperiodcode"];
    $saleheader1->customertypecode = $_POST["customertypecode"];
    $saleheader1->transactioncategoryid = $_POST["transactioncategoryid"];
    $saleheader1->shiftcode = $_POST["shiftcode"];
    //$saleheader1->petrolpumpcode = $_POST["petrolpumpcode"];
    $saleheader1->pumpcode = $_POST["pumpcode"];
    $saleheader1->transactionsubcategoryid = petrolpumpcode($connection,$saleheader1->pumpcode);
    //$saleheader1->documentnumberseriesid = $_POST["documentnumberseriesid"];
    $saleheader1->invoicedate = $_POST["invoicedate"];
    $saleheader1->customercode = $_POST["customercode"];
    $saleheader1->narration = $_POST["narration"];
    $saleheader1->entryspecial = $_POST["entryspecial"];

    $flag_de = fnDecrypt($_GET['flag']);
    $shiftcode_en = fnEncrypt($saleheader1->shiftcode);
    $petrolpumpcode_en = fnEncrypt($saleheader1->petrolpumpcode);
    $pumpcode_en = fnEncrypt($saleheader1->pumpcode);
    //$documentnumberseriesid_en = fnEncrypt($saleheader1->documentnumberseriesid);
    $customertypecode_en = fnEncrypt($saleheader1->customertypecode);
    $transactioncategoryid_en = fnEncrypt($saleheader1->transactioncategoryid);
    $transactionsubcategoryid_en = fnEncrypt($saleheader1->transactionsubcategoryid);
  function petrolpumpcode(&$connection,$pumpcode)
  {
    $query = "select p.petrolpumpcode from pump p 
            where p.pumpcode=".$pumpcode;
    $result = oci_parse($connection, $query);
    $r = oci_execute($result);
    if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
    {
      $petrolpumpcode=$row['PETROLPUMPCODE'];
    }
    else
    {
      $petrolpumpcode=0;
    }
    return $petrolpumpcode;
  }
  switch ($_POST['btn'])
  {
    case 'Add':
      $ret = $saleheader1->insert();
      if ($ret==1)
      {
        oci_commit($connection);
        $transactionid_en = fnEncrypt($saleheader1->transactionid);
        echo '<span class="w3-container" style="background-color:#0a0;color:#ff8;text-align:left;">Saleheader is added successfully</span></br>';
          if ($_SESSION['lng']=='English')
					{
					//	echo '<a href="../ip_view/saleheader.php?customertypecode='.$customertypecode_en.'&transactionsubcategoryid='.$transactionsubcategoryid_en.'&shiftcode='.$shiftcode_en.'&petrolpumpcode='.$petrolpumpcode_en.'&pumpcode='.$pumpcode_en.'&documentnumberseriesid='.$documentnumberseriesid_en.'&transactionid='.$transactionid_en.'">Display saleheader</br>';
              header("Location:../ip_view/saledetail.php?shiftcode='.$shiftcode_en.'&transactioncategoryid='.$transactioncategoryid_en.'&reftransactionid='.$transactionid_en.'"); /* Redirect browser */
              exit();
          }
					else
					{
             header("Location:../ip_view/saledetail.php?shiftcode='.$shiftcode_en.'&transactioncategoryid='.$transactioncategoryid_en.'&reftransactionid='.$transactionid_en.'"); /* Redirect browser */
              exit();
						//echo '<a href="../ip_view/saleheader.php?customertypecode='.$customertypecode_en.'&transactionsubcategoryid='.$transactionsubcategoryid_en.'&shiftcode='.$shiftcode_en.'&petrolpumpcode='.$petrolpumpcode_en.'&pumpcode='.$pumpcode_en.'&documentnumberseriesid='.$documentnumberseriesid_en.'&transactionid='.$transactionid_en.'">Display saleheader</br>';
					}
      }
      else
      {
        oci_rollback($connection);
        echo '<span style="background-color:#f44;color:#ff8;text-align:left;">'.$saleheader1->Get_invalidmessagetext().'</span></br>';
      }
      break;
    case 'Change':
      $saleheader1->transactionid = $_POST["transactionid"];
      $transactionid_en = fnEncrypt($saleheader1->transactionid);
      $ret = $saleheader1->update();
      $flag_en = fnEncrypt('Display');
      if ($ret==1)
      {
        oci_commit($connection);
        echo '<span class="w3-container" style="background-color:#0a0;color:#ff8;text-align:left;">Saleheader is Updated successfully</span></br>';  
          if ($_SESSION['lng']=='English')
					{
						echo '<a href="../ip_view/saleheader.php?shiftcode='.$shiftcode_en.'&transactioncategoryid='.$transactioncategoryid_en.'&transactionid='.$transactionid_en.'&flag='.$flag_en.'">Add saleheader</br>';
					}
					else
					{
						echo '<a href="../ip_view/saleheader.php?shiftcode='.$shiftcode_en.'&transactioncategoryid='.$transactioncategoryid_en.'&transactionid='.$transactionid_en.'&flag='.$flag_en.'">Add saleheader</br>';
					}

      }
      else
      {
        oci_rollback($connection);
        echo '<span style="background-color:#f44;color:#ff8;text-align:left;">'.$saleheader1->Get_invalidmessagetext().'</span></br>';
			}
			break;
		case 'Display':
      $saleheader1->transactionid = $_POST["transactionid"];
      $transactionid_en = fnEncrypt($saleheader1->transactionid);
			$result1 = $saleheader1->display();
			if ($saleheader1->Get_invalidid()==0)
			{
				while ($row1 = oci_fetch_array($result1,OCI_ASSOC+OCI_RETURN_NULLS))
				{
          $shiftcode_en = fnEncrypt($row1['SHIFTCODE']);
          $documentnumberseriesid_en = fnEncrypt($row1['DOCUMENTNUMBERSERIESID']);
          $transactionid_en = fnEncrypt($row1['TRANSACTIONID']);
          if ($_SESSION['lng']=='English')
					{
						echo '<a href="../ip_view/saleheader.php?shiftcode='.$shiftcode_en.'&transactioncategoryid='.$transactioncategoryid_en.'&transactionid='.$transactionid_en.'">'.$row1['INVOICENUMBER_SUFFPREF'].'</br>';
					}
					else
					{
						echo '<a href="../ip_view/saleheader.php?shiftcode='.$shiftcode_en.'&transactioncategoryid='.$transactioncategoryid_en.'&transactionid='.$transactionid_en.'">'.$row1['INVOICENUMBER_SUFFPREF'].'</br>';
					}
				}	
			}
			else
			{
				echo '<span style="background-color:#f44;color:#ff8;text-align:left;">'.$saleheader1->Get_invalidmessagetext().'</span></br>';
			}
			break;
		case 'Delete':
      $saleheader1->transactionid = $_POST["transactionid"];
      $transactionid_en = fnEncrypt($saleheader1->transactionid);
			$ret = $saleheader1->delete();
			if ($ret == 1)
			{
				oci_commit($connection);
        $flag_en = fnEncrypt('Query');
				echo '<span class="w3-container" style="background-color:#0a0;color:#ff8;text-align:left;">Saleheader is Deleted Successfully</span></br>';
          if ($_SESSION['lng']=='English')
					{
						echo '<a href="../ip_view/saleheader.php?shiftcode='.$shiftcode_en.'&transactioncategoryid='.$transactioncategoryid_en.'&transactionid='.$transactionid_en.'&flag='.$flag_en.'">Query saleheader</br>';
					}
					else
					{
						echo '<a href="../ip_view/saleheader.php?shiftcode='.$shiftcode_en.'&transactioncategoryid='.$transactioncategoryid.'&transactionid='.$transactionid_en.'&flag='.$flag_en.'">Query saleheader</br>';
					}
			}
			else
			{
				oci_rollback($connection);
				echo '<span style="background-color:#f44;color:#ff8;text-align:left;">'.$saleheader1->Get_invalidmessagetext().'</span></br>';
				echo '<a href="../ip_view/saleheader.php">Add/Query saleheader</a></br>';
			}
			break;
		default:
			echo 'Communication Error';
			break;
	}
