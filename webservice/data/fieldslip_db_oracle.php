<?php
//This is generated by Swapp Software Application on 30/05/2019 10:58:27 AM for PHP
class fieldslip
{
    Public $connection;
    Public $transactionnumber;
    Public $seasoncode;
    Public $fieldslipnumber;
    Public $fieldslipdate;
    Public $plotnumber;
    Public $farmercategorycode;
    Public $farmercode;
    Public $villagecode;
    Public $subvillagecode;
    Public $vehiclecategorycode;
    Public $vehiclecode;
    Public $tyregadicode;
    Public $hrsubcontractorcode;
    Public $hrtrsubcontractorcode;
    Public $trsubcontractorcode;
    Public $caneconditioncode;
    Public $slipboycode;
    Public $distance;
    Public $layercode;
    Public $trailornumber;
    Public $farmer;
    Public $village;
    Public $subvillage;
    Public $hrsubcontractor;
    Public $hrtrsubcontractor;
    Public $trsubcontractor;
    Public $vehicle;
    Public $slipboy;
    Public $containercode;
    Public $viadistance;
    Public $todslipnumber;
    public function __construct(&$connection)
    {
              //parent::__construct($connection);
         $this->connection=$connection;     
         $this->transactionnumber='';
         $this->seasoncode='';
         $this->fieldslipnumber='';
         $this->fieldslipdate='';
         $this->plotnumber='';
         $this->farmercategorycode='';
         $this->farmercode='';
         $this->villagecode='';
         $this->subvillagecode='';
         $this->vehiclecategorycode='';
         $this->vehiclecode='';
         $this->tyregadicode='';
         $this->hrsubcontractorcode='';
         $this->hrtrsubcontractorcode='';
         $this->trsubcontractorcode='';
         $this->caneconditioncode='';
         $this->slipboycode='';
         $this->distance='';
         $this->containercode='';
         $this->viadistance='';
	   }
    public function entryvalidation()
    {
        $this->invalidid=0;
    		$this->invalidmessagetext='Validated';
        return $this->invalidid;
      }
      
  
    private function datavalidation()
    {
    		$this->invalidid=0;
    		$this->invalidmessagetext='Validated';
    		return $this->invalidid;
    }
    public function insert()
    {
	    //if ($this->transactionnumber == '')
        //{
            $query = "select nvl(max(transactionnumber),0)+1 as transactionnumber from fieldslip";
            $result = oci_parse($this->connection, $query);
            $r = oci_execute($result);
            $row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
            $this->transactionnumber = $row["TRANSACTIONNUMBER"];
        //}
        if ($this->fieldslipnumber == '')
        {
            $query = "select nvl(max(fieldslipnumber),0)+1 as fieldslipnumber 
            from fieldslip
            where seasoncode=".$this->seasoncode;
            $result = oci_parse($this->connection, $query);
            $r = oci_execute($result);
            $row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
            $this->fieldslipnumber = $row["FIELDSLIPNUMBER"];
        }
        if ($this->fieldslipdate!='')
        {
            $this->fieldslipdate = DateTime::createFromFormat('Y-m-d H:i:s',$this->fieldslipdate)->format('d-M-Y H:i:s');
        }
        $query = "
            insert into fieldslip(
            transactionnumber
            ,seasoncode
            ,fieldslipnumber
            ,fieldslipdate
            ,plotnumber
            ,farmercategorycode
            ,farmercode
            ,villagecode
            ,subvillagecode
            ,vehiclecategorycode
            ,vehiclecode
            ,tyregadicode
            ,trailornumber
            ,hrsubcontractorcode
            ,hrtrsubcontractorcode
            ,trsubcontractorcode
            ,caneconditioncode
            ,layercode
            ,slipboycode
            ,containercode
            ,viadistance
            ,todslipnumber
	        )
	        values (
            ".$this->invl($this->transactionnumber,true)."
            ,".$this->invl($this->seasoncode,true)."
            ,".$this->invl($this->fieldslipnumber,true)."
            ,to_date(".$this->invl($this->fieldslipdate,false).",'DD-MON-YYYY HH24:MI:SS')
            ,".$this->invl($this->plotnumber,true)."
            ,".$this->invl($this->farmercategorycode,true,true)."
            ,(select farmercode from plantationheader p where seasoncode=".$this->invl($this->seasoncode,true)."
             and plotnumber=".$this->invl($this->plotnumber,true).")
            ,".$this->invl($this->villagecode,true,true)."
            ,".$this->invl($this->subvillagecode,true,true)."
            ,".$this->invl($this->vehiclecategorycode,true)."
            ,".$this->invl($this->vehiclecode,true,true)."
            ,".$this->invl($this->tyregadicode,true,true)."
            ,".$this->invl($this->trailornumber,false,true)."
            ,".$this->invl($this->hrsubcontractorcode,true,true)."
            ,".$this->invl($this->hrtrsubcontractorcode,true,true)."
            ,".$this->invl($this->trsubcontractorcode,true,true)."
            ,".$this->invl($this->caneconditioncode,true,true)."
            ,".$this->invl($this->layercode,true,true)."
            ,".$this->invl($this->slipboycode,true,true)."
            ,".$this->invl($this->containercode,true,true)."
            ,".$this->invl($this->viadistance,true,true)."
            ,".$this->invl($this->todslipnumber,true,true)."
            )";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            return 1;
            exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function delete()
    {
        $query = "
        delete from fieldslip
        where 
        seasoncode = ".$this->invl($this->seasoncode,true)." 
        and fieldslipnumber = ".$this->invl($this->fieldslipnumber,true);
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
             return 1;
             exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    protected function invl($data,$isnumber=true,$makezeronull=false,$relopr="")
{
	if (isset($relopr) and $relopr!="")
	{
		$opr=' '.$relopr.' ';
	}
	else
	{
		$opr="";
	}
	if (isset($data) and $data != "" and $makezeronull==false)
	{
		if ($isnumber == true)
		{
			return $opr.$data;
		}
		else
		{
			return $opr."'".$data."'";
		}
	}
	elseif (isset($data) and $data != "" and $makezeronull==true)
	{
		if ($data=='0' or $data==0)
		{
			if (isset($relopr) and $relopr!="")
			{
				return ' is Null';
			}
			else
			{
				return 'Null';
			}
		}
		else
		{
			if ($isnumber == true)
			{
				return $opr.$data;
			}
			else
			{
				return $opr."'".$data."'";
			}
		}
	}
	else
	{
		if (isset($relopr) and $relopr!="")
		{
			return ' is Null';
		}
		else
		{
			return 'Null';
		}
	}
}

}
?>

