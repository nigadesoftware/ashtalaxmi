<?php
//This is generated by Swapp Software Application on 17/03/2019 11:12:38 AM for PHP
require_once("../swappbase/formbase.php");
class saleinvoiceheader extends swappform
{
    Public $transactionnumber;
    Public $goodscategorycode;
    Public $salecategorycode;
    Public $yearperiodcode;
    Public $saleinvoicenumberseriesid;
    Public $saleinvoicenumberbasevalue;
    Public $invoicenumber;
    Public $invoicenumberpresuf;
    Public $invoicedate;
    Public $purchasercode;
    Public $shippingpartycode;
    Public $preparationtime;
    Public $removaltime;
    Public $vehiclenumber;
    Public $drivername;
    Public $driverlicenseno;
    Public $cgstamount;
    Public $sgstamount;
    Public $igstamount;
    Public $ugstamount;
    Public $vatamount;
    Public $tcsamount;
    Public $totaltaxamount;
    Public $grossamount;
    Public $taxableamount;
    Public $crushingseasonyear;
    Public $plotnumber;
    public $purchaser;
    Public $salecategorynameeng;
    Public $salecategorynameuni;
    Public $purchaserate;
    Public $totalquantity;
    Public $advance;
    public function __construct(&$connection)
    {
     	 parent::__construct($connection);
         $this->transactionnumber='';
         $this->goodscategorycode='';
         $this->salecategorycode='';
         $this->yearperiodcode='';
         $this->invoicenumber='';
         $this->invoicenumberpresuf='';
         $this->invoicedate='';
         $this->purchasercode='';
         $this->shippingpartycode='';
         $this->preparationtime='';
         $this->removaltime='';
         $this->vehiclenumber='';
         $this->drivername='';
         $this->driverlicenseno='';
	}
    private function entryvalidation()
    {
    	$this->start_validation();
        $this->checkrequired($this->invoicedate,'Invoice Date');
        $this->checkrequired($this->purchasercode,'Purchaser Name');
        //$this->checkrequired($this->crushingseasonyear,'Crushing Season Year');
        //$this->checkrequired($this->preparationtime,'Preparation Time');
        //$this->checkrequired($this->removaltime,'Removal Time');
        //$this->checkrequired($this->salecategorycode,'Sale Category');
        if ($this->salecategorycode==3)
        $this->checkrequired($this->plotnumber,'Plot Number');
        $this->end_validation();
        return $this->invalidid;
	  }
    private function datavalidation()
    {
        $this->start_validation();
        if ($this->salecategorycode==0)
        {
            $this->invalidid=-250;
            $this->invalidmessagetext='Sale Category Not Selected';
        }
        else
        {
            $this->invalidid=0;
            $this->invalidmessagetext='Validated';
        }
        $this->end_validation();
        return $this->invalidid;
    }
    public function generatesaleinvoicenumber()
	{
        if (!isset($this->invoicenumber) or $this->invoicenumber == '' )
        {
            $query = "select nvl(d.salenumberprefix,'') as salenumberprefix,periodresetcategorycode,transactioncategorycode from salenumberseries d where d.salenumberseriesid=".$this->saleinvoicenumberseriesid." and d.goodscategorycode=".$this->goodscategorycode;
            $result = oci_parse($this->connection, $query);
            $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
            if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
            {
                switch ($row['PERIODRESETCATEGORYCODE'])
                {
                    case 1:
                    {
                        $prefix = $row["SALENUMBERPREFIX"];
                        //Sale invoice transactioncategorycode=2
                        if ($row['TRANSACTIONCATEGORYCODE']==4)
                        {
                            //$invoicedate = DateTime::createFromFormat('d/m/Y',$this->invoicedate)->format('d-M-Y');
                            $query_12 = "select nvl(max(invoicenumber),0)+1 as invoicenumber,salenumberbasevalue('".$this->invoicedate."',1) as invoicenumberbasevalue  from saleinvoiceheader where yearperiodcode=".$this->yearperiodcode." and saleinvoicenumberbasevalue=salenumberbasevalue('".$this->invoicedate."',1) and saleinvoicenumberseriesid=".$this->saleinvoicenumberseriesid;
                        }
                        
                        $result_12 = oci_parse($this->connection, $query_12);
                        $r = oci_execute($result_12);
                        $row_12 = oci_fetch_array($result_12,OCI_ASSOC+OCI_RETURN_NULLS);
                        $THIS->invoicenumber = $ROW_12["INVOICENUMBER"];
                        $this->invoicenumberpresuf = $prefix.str_pad($row_12["INVOICENUMBER"],5,'0',STR_PAD_LEFT);
                        $this->invoicenumberbasevalue = $row_12["INVOICENUMBERBASEVALUE"];
                        break;
                    }
                    case 2:
                    {
                        $prefix = $row["SALENUMBERPREFIX"];
                        //Sale invoice transactioncategorycode=2
                        if ($row['TRANSACTIONCATEGORYCODE']==4)
                        {
                            //$invoicedate = DateTime::createFromFormat('d/m/Y',$this->invoicedate)->format('d-M-Y');
                            $query_12 = "select nvl(max(invoicenumber),0)+1 as invoicenumber,salenumberbasevalue('".$this->invoicedate."',2) as invoicenumberbasevalue  from saleinvoiceheader where yearperiodcode=".$this->yearperiodcode." and saleinvoicenumberbasevalue=salenumberbasevalue('".$this->invoicedate."',2) and saleinvoicenumberseriesid=".$this->saleinvoicenumberseriesid;
                        }
                        
                        //$query_12 = "select nvl(max(invoicenumber),0)+1 as invoicenumber,salenumberbasevalue('".$saledate."',2) as invoicenumberbasevalue from saleinvoiceheader where yearperiodcode=".$this->yearperiodcode." and invoicenumberbasevalue=salenumberbasevalue('".$saledate."',2) and invoicenumberseriesid=".$this->invoicenumberseriesid;
                        $result_12 = oci_parse($this->connection, $query_12);
                        $r = oci_execute($result_12);
                        $row_12 = oci_fetch_array($result_12,OCI_ASSOC+OCI_RETURN_NULLS);
                        $this->invoicenumber = $row_12["INVOICENUMBER"];
                        $this->invoicenumberpresuf = $prefix.str_pad($row_12["INVOICENUMBER"],5,'0',STR_PAD_LEFT);
                        $this->invoicenumberbasevalue = $row_12["INVOICENUMBERBASEVALUE"];
                        break;
                    }
                    case 3:
                    {
                        $prefix = $row["SALENUMBERPREFIX"];
                        //Sale invoice transactioncategorycode=2
                        if ($row['TRANSACTIONCATEGORYCODE']==4)
                        {
                            //$invoicedate = DateTime::createFromFormat('d/m/Y',$this->invoicedate)->format('d-M-Y');
                            $query_12 = "select nvl(max(invoicenumber),0)+1 as invoicenumber,salenumberbasevalue('".$this->invoicedate."',3) as invoicenumberbasevalue  from saleinvoiceheader where yearperiodcode=".$this->yearperiodcode." and saleinvoicenumberbasevalue=salenumberbasevalue('".$this->invoicedate."',3) and saleinvoicenumberseriesid=".$this->saleinvoicenumberseriesid;
                        }
                        //$query_12 = "select nvl(max(invoicenumber),0)+1 as invoicenumber,salenumberbasevalue('".$saledate."',3) as invoicenumberbasevalue from saleinvoiceheader where yearperiodcode=".$this->yearperiodcode." and invoicenumberbasevalue=salenumberbasevalue('".$saledate."',3) and invoicenumberseriesid=".$this->invoicenumberseriesid;
                        $result_12 = oci_parse($this->connection, $query_12);
                        $r = oci_execute($result_12);
                        $row_12 = oci_fetch_array($result_12,OCI_ASSOC+OCI_RETURN_NULLS);
                        $this->invoicenumber = $row_12["INVOICENUMBER"];
                        $this->invoicenumberpresuf = $prefix.str_pad($row_12["INVOICENUMBER"],5,'0',STR_PAD_LEFT);
                        $this->invoicenumberbasevalue = $row_12["INVOICENUMBERBASEVALUE"];
                        break;
                    }
                    case 4:
                    {
                        $prefix = $row["SALENUMBERPREFIX"];
                        if ($row['TRANSACTIONCATEGORYCODE']==4)
                        {
                            //$invoicedate = DateTime::createFromFormat('d/m/Y',$this->invoicedate)->format('d-M-Y');
                            $query_12 = "select nvl(max(invoicenumber),0)+1 as invoicenumber,salenumberbasevalue('".$this->invoicedate."',4) as invoicenumberbasevalue  from saleinvoiceheader where yearperiodcode=".$this->yearperiodcode." and saleinvoicenumberbasevalue=salenumberbasevalue('".$this->invoicedate."',4) and saleinvoicenumberseriesid=".$this->saleinvoicenumberseriesid;
                        }
                        if ($row['TRANSACTIONCATEGORYCODE']==6)
                        {
                            //$invoicedate = DateTime::createFromFormat('d/m/Y',$this->invoicedate)->format('d-M-Y');
                            $query_12 = "select nvl(max(invoicenumber),0)+1 as invoicenumber,salenumberbasevalue('".$this->invoicedate."',4) as invoicenumberbasevalue  from saleinvoiceheader where yearperiodcode=".$this->yearperiodcode." and saleinvoicenumberbasevalue=salenumberbasevalue('".$this->invoicedate."',4) and saleinvoicenumberseriesid=".$this->saleinvoicenumberseriesid;
                        }
                        //$query_12 = "select nvl(max(invoicenumber),0)+1 as invoicenumber,salenumberbasevalue('".$saledate."',4) as invoicenumberbasevalue from saleinvoiceheader where yearperiodcode=".$this->yearperiodcode." and invoicenumberbasevalue=salenumberbasevalue('".$saledate."',4) and invoicenumberseriesid=".$this->invoicenumberseriesid;
                        $result_12 = oci_parse($this->connection, $query_12);
                        $r = oci_execute($result_12);
                        $row_12 = oci_fetch_array($result_12,OCI_ASSOC+OCI_RETURN_NULLS);
                        $this->invoicenumber = $row_12["INVOICENUMBER"];
                        $this->invoicenumberpresuf = $prefix.'/'.substr($this->yearperiodcode,2,2).substr($this->yearperiodcode,6,2).'/'.str_pad($row_12["INVOICENUMBER"],5,'0',STR_PAD_LEFT);
                        $this->saleinvoicenumberbasevalue = $row_12["INVOICENUMBERBASEVALUE"];
                        break;
                    }
                }
                return 1;
                exit;
            }
            else
            {
                return 0;
                exit;
            }
        }
        else
        {
            return 0;
            exit;
        }
	}
    public function insert()
    {
        $this->dataoperationmode = operationmode::Insert;
	    if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
        if ($this->saleinvoicenumberseriesid == '')
        {
            $query = "select s.saleinvoicenumberseriesid
            from salecategory s
            where salecategorycode=".$this->salecategorycode;
            $result = oci_parse($this->connection, $query);
            $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
            $row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
            $this->saleinvoicenumberseriesid = $row["SALEINVOICENUMBERSERIESID"];
        }
	    if ($this->transactionnumber == '')
        {
            $query = "select nvl(max(transactionnumber),0)+1 as transactionnumber from saleinvoiceheader";
            $result = oci_parse($this->connection, $query);
            $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
            $row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
            $this->transactionnumber = $row["TRANSACTIONNUMBER"];
        }
        if ($this->invoicedate!='')
        {
            $this->invoicedate = DateTime::createFromFormat('d/m/Y',$this->invoicedate)->format('d-M-Y');
        }
        if ($this->preparationtime!='')
        {
            $this->preparationtime = DateTime::createFromFormat('d/m/Y H:i',$this->preparationtime)->format('d-M-Y H:i');
        }
        if ($this->removaltime!='')
        {
            $this->removaltime = DateTime::createFromFormat('d/m/Y H:i',$this->removaltime)->format('d-M-Y H:i');
        }
        if ($this->salecategorycode!=3)
        {
            $this->generatesaleinvoicenumber();
        }
        $query = "
            insert into saleinvoiceheader(
            transactionnumber
            ,goodscategorycode
            ,salecategorycode
            ,yearperiodcode
            ,saleinvoicenumberseriesid
            ,saleinvoicenumberbasevalue
            ,invoicenumber
            ,invoicenumberpresuf
            ,invoicedate
            ,purchasercode
            ,cgstamount
            ,sgstamount
            ,igstamount
            ,ugstamount
            ,tcsamount
            ,vatamount
            ,totaltaxamount
            ,grossamount
            ,taxableamount
            ,crushingseasonyear
            ,plotnumber
            ,purchaserate
            ,advance
	        )
	        values (
            ".$this->invl($this->transactionnumber,true)."
            ,".$this->invl($this->goodscategorycode,true)."
            ,".$this->invl($this->salecategorycode,true,true)."
            ,".$this->invl($this->yearperiodcode,true)."
            ,".$this->invl($this->saleinvoicenumberseriesid,true)."
            ,".$this->invl($this->saleinvoicenumberbasevalue,false)."
            ,".$this->invl($this->invoicenumber,true)."
            ,".$this->invl($this->invoicenumberpresuf,false)."
            ,".$this->invl($this->invoicedate,false)."
            ,".$this->invl($this->purchasercode,true,true)."
            ,".$this->invl($this->cgstamount,true)."
            ,".$this->invl($this->sgstamount,true)."
            ,".$this->invl($this->igstamount,true)."
            ,".$this->invl($this->ugstamount,true)."
            ,".$this->invl($this->tcsamount,true)."
            ,".$this->invl($this->vatamount,true)."
            ,".$this->invl($this->totaltaxamount,true)."
            ,".$this->invl($this->grossamount,true)."
            ,".$this->invl($this->taxableamount,true)."
            ,".$this->invl($this->crushingseasonyear,true)."
            ,".$this->invl($this->plotnumber,true,true)."
            ,".$this->invl($this->purchaserate,true,true)."
            ,".$this->invl($this->advance,true,true)."
            )";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            return 1;
            exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function display()
	  {
		    $this->dataoperationmode = operationmode::Select;
		    $cond='';
		    if ($this->salecategorycode!='' and $this->salecategorycode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.salecategorycode = ".$this->salecategorycode;
			       }
			       else
			       {
				         $cond=$cond." and t.salecategorycode = ".$this->salecategorycode;
			       }
		    }
		    if ($this->invoicenumber!='' and $this->invoicenumber!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.invoicenumber = ".$this->invoicenumber;
			       }
			       else
			       {
				         $cond=$cond." and t.invoicenumber = ".$this->invoicenumber;
			       }
		    }
		    if ($this->invoicenumberpresuf!='')
		    {
			      if ($cond=='')
			      {
				        $cond="t.invoicenumberpresuf like '%".$this->invoicenumberpresuf."%'";
			       }
			       else
			       {
				         $cond=$cond." and t.invoicenumberpresuf like '%".$this->invoicenumberpresuf."%'";
			       }
		    }
		    if ($this->invoicedate!='')
		    {
			      $this->invoicedate = DateTime::createFromFormat('d/m/Y',$this->invoicedate)->format('d-M-Y');
			      if ($cond=='')
			      {
				        $cond="t.invoicedate = '".$this->invoicedate."'";
			       }
			       else
			       {
				         $cond=$cond." and t.invoicedate = '".$this->invoicedate."'";
			       }
		    }
		    if ($this->brokercode!='' and $this->brokercode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.brokercode = ".$this->brokercode;
			       }
			       else
			       {
				         $cond=$cond." and t.brokercode = ".$this->brokercode;
			       }
		    }
		    if ($this->purchasercode!='' and $this->purchasercode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.purchasercode = ".$this->purchasercode;
			       }
			       else
			       {
				         $cond=$cond." and t.purchasercode = ".$this->purchasercode;
			       }
		    }
		    if ($this->vehiclenumber!='')
		    {
			      if ($cond=='')
			      {
				        $cond="t.vehiclenumber like '%".$this->vehiclenumber."%'";
			       }
			       else
			       {
				         $cond=$cond." and t.vehiclenumber like '%".$this->vehiclenumber."%'";
			       }
		    }
        if ($cond!='')
		    {
		        $query = "select t.* from saleinvoiceheader t where ".$cond." and goodscategorycode=".$this->goodscategorycode." order by transactionnumber";
			    $result = oci_parse($this->connection, $query);
                $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
			    return $result;
		    }
		    else
		    {
		        $query = "select t.* from saleinvoiceheader t where goodscategorycode=".$this->goodscategorycode." order by transactionnumber"; 
			    $result = oci_parse($this->connection, $query);
                $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
			    return $result;
		    }
	  }
    public function update()
    {
        $this->dataoperationmode = operationmode::Update;
        if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
        $this->invoicedate = DateTime::createFromFormat('d/m/Y',$this->invoicedate)->format('d-M-Y');
        $query = "
        update saleinvoiceheader set 
        goodscategorycode = ".$this->invl($this->goodscategorycode,true)."
        ,salecategorycode = ".$this->invl($this->salecategorycode,true)."
        ,yearperiodcode = ".$this->invl($this->yearperiodcode,true)."
        ,saleinvoicenumberseriesid = ".$this->invl($this->saleinvoicenumberseriesid,true)."
        ,saleinvoicenumberbasevalue = ".$this->invl($this->saleinvoicenumberbasevalue,false)."
        ,invoicenumber = ".$this->invl($this->invoicenumber,true)."
        ,invoicenumberpresuf =".$this->invl($this->invoicenumberpresuf,false)."
        ,invoicedate =".$this->invl($this->invoicedate,false)."
        ,purchasercode = ".$this->invl($this->purchasercode,true)."
        ,cgstamount = ".$this->invl($this->cgstamount,true)."
        ,sgstamount = ".$this->invl($this->sgstamount,true)."
        ,igstamount = ".$this->invl($this->igstamount,true)."
        ,ugstamount = ".$this->invl($this->ugstamount,true)."
        ,vatamount = ".$this->invl($this->vatamount,true)."
        ,tcsamount = ".$this->invl($this->tcsamount,true)."
        ,totaltaxamount = ".$this->invl($this->totaltaxamount,true)."
        ,grossamount = ".$this->invl($this->grossamount,true)."
        ,taxableamount = ".$this->invl($this->taxableamount,true)." 
        ,crushingseasonyear=".$this->invl($this->crushingseasonyear,true)."
        ,plotnumber=".$this->invl($this->plotnumber,true,true)."
        ,purchaserate=".$this->invl($this->purchaserate,true,true)."
        ,advance=".$this->invl($this->advance,true,true)."
        where 
        transactionnumber = ".$this->invl($this->transactionnumber,true)."
        ";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            if ($this->salecategorycode !=3)
            {
                $sql = 'BEGIN saleinvoiceheader_update(:p_transactionnumber); END;';
                $result = oci_parse($this->connection,$sql);
                oci_bind_by_name($result,':p_transactionnumber',$transactionnumber,20);
                $transactionnumber=$this->transactionnumber;
                $r=oci_execute($result);
                return 1;
                exit;
            }
            else
            {
                return 1;
                exit;
            }
        }
            else
        {
            return 0;
            exit;
        }
    }
    public function delete()
    {
        $this->dataoperationmode = operationmode::Delete;
        if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
        $this->invoicedate = DateTime::createFromFormat('d/m/Y',$this->invoicedate)->format('d-M-Y');
        $query = "
        delete from saleinvoiceheader
        where 
        transactionnumber = ".$this->invl($this->transactionnumber,true)."
        ";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
             return 1;
             exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function fetch()
    {
        $this->dataoperationmode = operationmode::Select;
        $query = "select 
        h.transactionnumber
        ,h.goodscategorycode
        ,h.salecategorycode
        ,yearperiodcode
        ,h.saleinvoicenumberseriesid
        ,saleinvoicenumberbasevalue
        ,invoicenumber
        ,invoicenumberpresuf
        ,invoicedate
        ,purchasercode
        ,cgstamount
        ,sgstamount
        ,igstamount
        ,ugstamount
        ,tcsamount
        ,totaltaxamount
        ,grossamount
        ,s.salecategorynameeng
        ,s.salecategorynameuni
        ,taxableamount
        ,f.farmernameuni
        ,f.farmernameeng
        ,crushingseasonyear
        ,plotnumber
        ,purchaserate
        ,totalquantity
        ,saleamount
        ,advance
        from saleinvoiceheader h
        ,salecategory s 
        ,nst_nasaka_agriculture.farmer f
        where h.salecategorycode=s.salecategorycode
        and h.purchasercode=f.farmercode
        and h.transactionnumber = ".$this->invl($this->transactionnumber,true)."
        ";
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            $this->transactionnumber = $row['TRANSACTIONNUMBER'];
            $this->goodscategorycode = $row['GOODSCATEGORYCODE'];
            $this->salecategorycode = $row['SALECATEGORYCODE'];
            $this->yearperiodcode = $row['YEARPERIODCODE'];
            $this->saleinvoicenumberseriesid = $row['SALEINVOICENUMBERSERIESID'];
            $this->saleinvoicenumberbasevalue = $row['SALEINVOICENUMBERBASEVALUE'];
            $this->invoicenumber = $row['INVOICENUMBER'];
            $this->invoicenumberpresuf = $row['INVOICENUMBERPRESUF'];
            $this->invoicedate = DateTime::createFromFormat('d-M-y',$row['INVOICEDATE'])->format('d/m/Y');
            $this->purchasercode = $row['PURCHASERCODE'];
            $this->cgstamount = $row['CGSTAMOUNT'];
            $this->sgstamount = $row['SGSTAMOUNT'];
            $this->igstamount = $row['IGSTAMOUNT'];
            $this->ugstamount = $row['UGSTAMOUNT'];
            $this->vatamount = $row['VATAMOUNT'];
            $this->tcsamount = $row['TCSAMOUNT'];
            $this->totaltaxamount = $row['TOTALTAXAMOUNT'];
            $this->grossamount = $row['GROSSAMOUNT'];
            $this->taxableamount = $row['TAXABLEAMOUNT'];
            $this->crushingseasonyear = $row['CRUSHINGSEASONYEAR'];
            $this->plotnumber = $row['PLOTNUMBER'];
            $this->purchaserate = $row['PURCHASERATE'];
            $this->totalquantity = $row['TOTALQUANTITY'];
            $this->saleamount = $row['SALEAMOUNT'];
            if ($_SESSION['lng']=="English")
            {
                $this->purchaser = $row['FARMERNAMEENG'];
            }
            else
            {
                $this->purchaser = $row['FARMERNAMEUNI'];
            }
            $this->salecategorynameeng = $row['SALECATEGORYNAMEENG'];
            $this->salecategorynameuni = $row['SALECATEGORYNAMEUNI'];
            $this->advance = $row['ADVANCE'];
            $this->found=true;
            return true;
        }
        else
        {
        return false;
        }
    }
    public function isinvoiceexist()
    {
        $this->dataoperationmode = operationmode::Select;
        $query = "select count(*) as cnt 
        from saleinvoiceheader h
        where h.goodscategorycode = ".$this->goodscategorycode." 
        and h.saleinvoicetransactionnumber = ".$this->transactionnumber;
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            if ($row['CNT']==0)
            {
                return false;
            }
            else
            {
                return true;
            }
        }
        else
        {
            return false;
        }
    }
     public function tendercategory()
    {
        $this->dataoperationmode = operationmode::Select;
        $query = "select 
        t.tendercategorycode 
        from goodscategory t 
        where t.goodscategorycode= ".$this->invl($this->goodscategorycode,true)."
        ";
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            return $row['TENDERCATEGORYCODE'];
        }
        else
        {
         return 0;   
        }
    }
      public function hsncode()
    {
        $this->dataoperationmode = operationmode::Select;
        $query = "select 
        t.hsncode
        from goodscategory t 
        where t.goodscategorycode= ".$this->invl($this->goodscategorycode,true)."
        ";
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            return $row['HSNCODE'];
        }
        else
        {
         return 0;   
        }
    }
    public function voucherposting()
    {
        //Bene_Bill_Swapp_Posting(p_saletransactionnumber in number,p_action in number,p_ret out number
        $transactionnumber=$this->transactionnumber;
        $act=1;
        $sql = 'BEGIN Bene_Bill_Swapp_Posting(:p_saletransactionnumber,:p_action,:p_ret); END;';
        $result = oci_parse($this->connection,$sql);
        oci_bind_by_name($result,':p_saletransactionnumber',$transactionnumber,20,SQLT_INT);
        oci_bind_by_name($result,':p_action',$act,10,SQLT_INT);
        oci_bind_by_name($result,':p_ret',$p_ret,10,SQLT_INT);
        $r=oci_execute($result);
        return 1;
        /* if ($p_ret==1)
        {
            return 1;
        }
        else
        {
            return 0;
        } */
    }
}
?>