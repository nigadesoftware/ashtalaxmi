<?php
//This is generated by Swapp Software Application on 06/06/2019 12:46:27 PM for PHP
require_once("../swappbase/formbase.php");
require_once("../ip_model/caneyardtoken_db_oracle.php");
require_once("../ip_model/fieldslip_db_oracle.php");
class weightslip extends swappform
{
    Public $transactionnumber;
    Public $seasoncode;
    Public $weightslipnumber;
    Public $fieldslipnumber;
    Public $tokentransactionnumber;
    Public $weighmentdate;
    Public $loadweighmentdate;
    Public $loadweight;
    Public $emptyweight;
    Public $bindingmaterial;
    Public $netweight;
    Public $shiftcode;
    Public $loadshiftcode;
    Public $loaddatetime;
    Public $emptydatetime;
    Public $loadkatacode;
    Public $katacode;
    Public $loadusercode;
    Public $emptyusercode;
    Public $flag;
    Public $vehiclecode;
    Public $tyregadicode;
    Public $fieldslip;
    Public $caneyardtoken;
    Public $vehiclecategorycode;
    Public $weightcategorycode;
    Public $vehicle;
    Public $tyregadi;
    Public $farmercode;
    Public $farmer;
    public $layer;
    public $container;
    public $dieseldistance;
    public $dieselquantity;
    public function __construct(&$connection)
    {
     		 parent::__construct($connection);
         $this->transactionnumber='';
         $this->seasoncode='';
         $this->weightslipnumber='';
         $this->fieldslipnumber='';
         $this->tokentransactionnumber='';
         $this->weighmentdate='';
         $this->loadweight='';
         $this->emptyweight='';
         $this->bindingmaterial='';
         $this->netweight='';
         $this->shiftcode='';
         $this->bindingrate='';
         $this->loaddatetime='';
         $this->emptydatetime='';
         $this->loadkatacode='';
         $this->katacode='';
         $this->loadusercode='';
         $this->emptyusercode='';
         $this->flag='';
	   }
    public function entryvalidation()
    {
    	$this->start_validation();
        $this->checkrequired($this->loadweight,'Load Weight');
        $this->checkrequired($this->fieldslipnumber,'Fieldslip Number');
        //$this->checkrequired($this->tokentransactionnumber,'Token Number');
        if ($this->weightcategorycode==2 and $this->dataoperationmode==operationmode::Update)
        {
            $this->checkrequired($this->weighmentdate,'Weighment Date');
            $this->checkrequired($this->shiftcode,'Shift');
            $this->checkrequired($this->katacode,'Kata');
            $this->checkrequired($this->emptyweight,'Empty Weight');
            $this->checkrequired($this->netweight,'Net Weight');
        }
        elseif ($this->weightcategorycode==3)
        {
            $this->checkrequired($this->weighmentdate,'Weighment Date');
            $this->checkrequired($this->shiftcode,'Shift');
            $this->checkrequired($this->katacode,'Kata');
            $this->checkrequired($this->loadweight,'Load Weight');
            $this->checkrequired($this->emptyweight,'Empty Weight');
            $this->checkrequired($this->netweight,'Net Weight');
        }
        $this->end_validation();
        return $this->invalidid;
	}
    private function datavalidation()
    {
        $this->start_validation();
    		$this->invalidid=0;
    		$this->invalidmessagetext='Validated';
    		$this->end_validation();
    		return $this->invalidid;
    }
    public function insert()
    {
        $this->dataoperationmode = operationmode::Insert;
	    if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
	    if ($this->transactionnumber == '')
        {
            $query = "select nvl(max(transactionnumber),0)+1 as transactionnumber from weightslip";
            $result = oci_parse($this->connection, $query);
            $r = oci_execute($result);
            $row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
            $this->transactionnumber = $row["TRANSACTIONNUMBER"];
        }
        if ($this->loadweighmentdate!='')
        {
            $this->loadweighmentdate = DateTime::createFromFormat('d/m/Y',$this->loadweighmentdate)->format('d-M-Y');
        }
        if ($this->loaddatetime=='' or $this->loaddatetime==null)
        {
            $query = "select to_char(sysdate,'dd-mon-yyyy hh24:mi:ss') as dt
            from dual";
            $result = oci_parse($this->connection, $query);
            $r = oci_execute($result);
            $row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
            $this->loaddatetime = $row['DT'];
        }
        if ($this->weightcategorycode==3)
        {
            if ($this->weightslipnumber == '')
            {
                $query = "select nvl(max(weightslipnumber),0)+1 as weightslipnumber 
                from weightslip
                where seasoncode=".$_SESSION['yearperiodcode'];
                $result = oci_parse($this->connection, $query);
                $r = oci_execute($result);
                $row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
                $this->weightslipnumber = $row["WEIGHTSLIPNUMBER"];
            }
            if ($this->weighmentdate!='')
            {
                $this->weighmentdate = DateTime::createFromFormat('d/m/Y',$this->weighmentdate)->format('d-M-Y');
            }
            if ($this->emptydatetime=='' or $this->emptydatetime==null)
            {
                $query = "select to_char(sysdate,'dd-mon-yyyy hh24:mi:ss') as dt
                from dual";
                $result = oci_parse($this->connection, $query);
                $r = oci_execute($result);
                $row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
                $this->emptydatetime = $row['DT'];
            }
        }
        
        if ($this->weightcategorycode==1)
        {
            $query = "
            insert into weightslip(
            transactionnumber
            ,seasoncode
            ,fieldslipnumber
            ,tokentransactionnumber
            ,loadweighmentdate
            ,loadweight
            ,loadshiftcode
            ,loaddatetime
            ,loadkatacode
            ,loadusercode
            ,dieseldistance
            ,dieselquantity
	        )
	        values (
            ".$this->invl($this->transactionnumber,true)."
            ,".$this->invl($this->seasoncode,true)."
            ,".$this->invl($this->fieldslipnumber,true,true)."
            ,".$this->invl($this->tokentransactionnumber,true,true)."
            ,".$this->invl($this->loadweighmentdate,false)."
            ,".$this->invl($this->loadweight,true)."
            ,".$this->invl($this->loadshiftcode,true)."
            ,to_date('".$this->loaddatetime."','dd-mon-yyyy hh24:mi:ss')"."
            ,".$this->invl($this->loadkatacode,true)."
            ,".$_SESSION['usersid']."
            ,".$this->invl($this->dieseldistance,true,true)."
            ,".$this->invl($this->dieselquantity,true,true)."
            )";
        }
        else if ($this->weightcategorycode==3)
        {
            $query = "
            insert into weightslip(
            transactionnumber
            ,seasoncode
            ,fieldslipnumber
            ,tokentransactionnumber
            ,loadweighmentdate
            ,loadweight
            ,loadshiftcode
            ,loaddatetime
            ,loadkatacode
            ,loadusercode
            ,weightslipnumber
            ,weighmentdate
            ,shiftcode
            ,emptyweight
            ,bindingmaterial
            ,netweight
            ,katacode
            ,emptyusercode
            ,emptydatetime
	        )
	        values (
            ".$this->invl($this->transactionnumber,true)."
            ,".$this->invl($this->seasoncode,true)."
            ,".$this->invl($this->fieldslipnumber,true,true)."
            ,".$this->invl($this->tokentransactionnumber,true,true)."
            ,".$this->invl($this->loadweighmentdate,false)."
            ,".$this->invl($this->loadweight,true)."
            ,".$this->invl($this->loadshiftcode,true)."
            ,to_date('".$this->loaddatetime."','dd-mon-yyyy hh24:mi:ss')"."
            ,".$this->invl($this->loadkatacode,true)."
            ,".$_SESSION['usersid']."
            ,".$this->invl($this->weightslipnumber,true)."
            ,".$this->invl($this->weighmentdate,false)."
            ,".$this->invl($this->shiftcode,true)."
            ,".$this->invl($this->emptyweight,true)."
            ,".$this->invl($this->bindingmaterial,true)."
            ,".$this->invl($this->netweight,true)."
            ,".$this->invl($this->katacode,true)."
            ,".$_SESSION['usersid']."
            ,to_date('".$this->emptydatetime."','dd-mon-yyyy hh24:mi:ss')"."
            )";
        }
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            return 1;
            exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function display()
	  {
		    $this->dataoperationmode = operationmode::Select;
		    $cond='';
		    if ($this->seasoncode!='' and $this->seasoncode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.seasoncode = ".$this->seasoncode;
			       }
			       else
			       {
				         $cond=$cond." and t.seasoncode = ".$this->seasoncode;
			       }
		    }
		    if ($this->weightslipnumber!='' and $this->weightslipnumber!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.weightslipnumber = ".$this->weightslipnumber;
			       }
			       else
			       {
				         $cond=$cond." and t.weightslipnumber = ".$this->weightslipnumber;
			       }
		    }
		    if ($this->fieldslipnumber!='' and $this->fieldslipnumber!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.fieldslipnumber = ".$this->fieldslipnumber;
			       }
			       else
			       {
				         $cond=$cond." and t.fieldslipnumber = ".$this->fieldslipnumber;
			       }
		    }
		    if ($this->tokentransactionnumber!='' and $this->tokentransactionnumber!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.tokentransactionnumber = ".$this->tokentransactionnumber;
			       }
			       else
			       {
				         $cond=$cond." and t.tokentransactionnumber = ".$this->tokentransactionnumber;
			       }
		    }
		    if ($this->weighmentdate!='')
		    {
			      $this->weighmentdate = DateTime::createFromFormat('d/m/Y',$this->weighmentdate)->format('d-M-Y');
			      if ($cond=='')
			      {
				        $cond="t.weighmentdate = '".$this->weighmentdate."'";
			       }
			       else
			       {
				         $cond=$cond." and t.weighmentdate = '".$this->weighmentdate."'";
			       }
		    }
		    if ($this->loadweight!='' and $this->loadweight!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.loadweight = ".$this->loadweight;
			       }
			       else
			       {
				         $cond=$cond." and t.loadweight = ".$this->loadweight;
			       }
		    }
		    if ($this->emptyweight!='' and $this->emptyweight!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.emptyweight = ".$this->emptyweight;
			       }
			       else
			       {
				         $cond=$cond." and t.emptyweight = ".$this->emptyweight;
			       }
		    }
		    if ($this->netweight!='' and $this->netweight!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.netweight = ".$this->netweight;
			       }
			       else
			       {
				         $cond=$cond." and t.netweight = ".$this->netweight;
			       }
		    }
		    if ($this->shiftcode!='' and $this->shiftcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.shiftcode = ".$this->shiftcode;
			       }
			       else
			       {
				         $cond=$cond." and t.shiftcode = ".$this->shiftcode;
			       }
		    }
		    if ($this->loadkatacode!='' and $this->loadkatacode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.loadkatacode = ".$this->loadkatacode;
			       }
			       else
			       {
				         $cond=$cond." and t.loadkatacode = ".$this->loadkatacode;
			       }
		    }
		    if ($this->katacode!='' and $this->katacode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.katacode = ".$this->katacode;
			       }
			       else
			       {
				         $cond=$cond." and t.katacode = ".$this->katacode;
			       }
            }
            if ($this->vehiclecategorycode!='' and $this->vehiclecategorycode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="f.vehiclecategorycode = ".$this->vehiclecategorycode;
			       }
			       else
			       {
				         $cond=$cond." and f.vehiclecategorycode = ".$this->vehiclecategorycode;
			       }
            }
            if ($this->vehiclecode!='' and $this->vehiclecode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="f.vehiclecode = ".$this->vehiclecode;
			       }
			       else
			       {
				         $cond=$cond." and f.vehiclecode = ".$this->vehiclecode;
			       }
            }
            if ($this->tyregadicode!='' and $this->tyregadicode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="f.tyregadicode = ".$this->tyregadicode;
			       }
			       else
			       {
				         $cond=$cond." and f.tyregadicode = ".$this->tyregadicode;
			       }
		    }
            if ($this->weightcategorycode==1)
		    {
                if ($cond=='')
                {
                    $cond="nvl(t.loadweight,0)>=0 and nvl(t.netweight,0)=0";
                }
                else
                {
                        $cond=$cond." and nvl(t.loadweight,0)>=0 and nvl(t.netweight,0)=0";
                }
            }
            if ($this->weightcategorycode==2)
		    {
                if ($cond=='')
                {
                    $cond="nvl(t.loadweight,0)>0 and nvl(t.netweight,0)=0";
                }
                else
                {
                        $cond=$cond." and nvl(t.loadweight,0)>0 and nvl(t.netweight,0)=0";
                }
		    }
        if ($cond!='')
		    {
                $query = "select t.* from weightslip t ,fieldslip f
                where t.fieldslipnumber =f.fieldslipnumber and t.seasoncode=f.seasoncode and ".$cond." order by t.transactionnumber desc";
			      $result = oci_parse($this->connection, $query);
            $r = oci_execute($result);
			      return $result;
		     }
		     else
		     {
                 $query = "select t.* from weightslip t ,
                 fieldslip f where t.fieldslipnumber =f.fieldslipnumber and t.seasoncode=f.seasoncode  order by t.transactionnumber desc";
			       $result = oci_parse($this->connection, $query);
             $r = oci_execute($result);
			       return $result;
		     }
	  }
    public function update()
    {
        $this->dataoperationmode = operationmode::Update;
        if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
   	    if ($this->weightslipnumber == '')
        {
            $query = "select nvl(max(weightslipnumber),0)+1 as weightslipnumber 
            from weightslip
            where seasoncode=".$_SESSION['yearperiodcode'];
            $result = oci_parse($this->connection, $query);
            $r = oci_execute($result);
            $row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
            $this->weightslipnumber = $row["WEIGHTSLIPNUMBER"];
        }
        if ($this->weighmentdate!='')
        {
            $this->weighmentdate = DateTime::createFromFormat('d/m/Y',$this->weighmentdate)->format('d-M-Y');
        }
        if ($this->emptydatetime=='' or $this->emptydatetime==null)
        {
            $query = "select to_char(sysdate,'dd-mon-yyyy hh24:mi:ss') as dt
            from dual";
            $result = oci_parse($this->connection, $query);
            $r = oci_execute($result);
            $row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
            $this->emptydatetime = $row['DT'];
        }
        if ($this->alterdatetime=='' or $this->alterdatetime==null)
        {
            $query = "select to_char(sysdate,'dd-mon-yyyy hh24:mi:ss') as dt
            from dual";
            $result = oci_parse($this->connection, $query);
            $r = oci_execute($result);
            $row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
            $this->alterdatetime = $row['DT'];
        }
        if ($this->weightcategorycode==2)
        {
            $query = "select getdieseldistance(t.seasoncode,t.fieldslipnumber) dieseldistance,getdieselquantity(t.seasoncode,t.fieldslipnumber) dieselquantity
                    from (
                    select t.seasoncode,t.fieldslipnumber,isdieselgiven5hrs(t.seasoncode,t.fieldslipnumber) isdieselgiven
                    from FIELDSLIP t 
                    where seasoncode={$this->seasoncode} and t.fieldslipnumber={$this->fieldslipnumber}) t
                    where isdieselgiven=0";
            $result = oci_parse($this->connection, $query);
            $r = oci_execute($result);
            if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
            {
                //$this->dieseldistance=$row['DIESELDISTANCE'];
                //$this->dieselquantity=$row['DIESELQUANTITY'];
            }
            else
            {
                //$this->dieseldistance=0;
                //$this->dieselquantity=0;
            }
            if ($this->dieselquantity=='')
            {
                $this->dieselquantity=0;
            }
            if ($this->dieseldistance=='')
            {
                $this->dieseldistance=0;
            }
        }
        if ($this->weightcategorycode==2)
        {
            $query = "
            update weightslip set 
            seasoncode = ".$this->invl($this->seasoncode,true)."
            ,weightslipnumber = ".$this->invl($this->weightslipnumber,true)."
            ,fieldslipnumber = ".$this->invl($this->fieldslipnumber,true)."
            ,tokentransactionnumber = ".$this->invl($this->tokentransactionnumber,true)."
            ,weighmentdate =".$this->invl($this->weighmentdate,false)."
            ,shiftcode = ".$this->invl($this->shiftcode,true)."
            ,loadweight = ".$this->invl($this->loadweight,true)."
            ,emptyweight = ".$this->invl($this->emptyweight,true)."
            ,bindingmaterial = ".$this->invl($this->bindingmaterial,true)."
            ,netweight = ".$this->invl($this->netweight,true)."
            ,katacode = ".$this->invl($this->katacode,true)."
            ,emptyusercode = ".$_SESSION['usersid']."
            ,emptydatetime =  to_date(".$this->invl($this->emptydatetime,false).",'dd-mon-yyyy hh24:mi:ss')"."
            ,dieseldistance=".$this->dieseldistance."
            ,dieselquantity=".$this->dieselquantity." 
            where 
            transactionnumber = ".$this->invl($this->transactionnumber,true)."
            ";
        }
        else if ($this->weightcategorycode==3)
        {
            $query = "
            update weightslip set 
            seasoncode = ".$this->invl($this->seasoncode,true)."
            ,fieldslipnumber = ".$this->invl($this->fieldslipnumber,true,true)."
            ,tokentransactionnumber = ".$this->invl($this->tokentransactionnumber,true,true)."
            ,weightslipnumber = ".$this->invl($this->weightslipnumber,true)."
            ,loadweight = ".$this->invl($this->loadweight,true)."
            ,emptyweight = ".$this->invl($this->emptyweight,true)."
            ,bindingmaterial = ".$this->invl($this->bindingmaterial,true)."
            ,netweight = ".$this->invl($this->netweight,true)."
            ,katacode = ".$this->invl($this->katacode,true)."
            ,alterusercode = ".$_SESSION['usersid']."
            ,alterdatetime = to_date('".$this->alterdatetime."','dd-mon-yyyy hh24:mi:ss')"."
            ,dieselquantity = ".$this->invl($this->dieselquantity,true)."
            ,dieseldistance = ".$this->invl($this->dieseldistance,true)."
            where 
            transactionnumber = ".$this->invl($this->transactionnumber,true)."
            ";
        }
        
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            return 1;
            exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function delete()
    {
        $this->dataoperationmode = operationmode::Delete;
        $query = "
        delete from weightslip
        where 
        transactionnumber = ".$this->invl($this->transactionnumber,true)."
        ";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
             return 1;
             exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function fetch()
    {
        $this->dataoperationmode = operationmode::Select;
        $query = "select 
        transactionnumber
        ,seasoncode
        ,weightslipnumber
        ,fieldslipnumber
        ,tokentransactionnumber
        ,weighmentdate
        ,loadweighmentdate
        ,loadweight
        ,emptyweight
        ,bindingmaterial
        ,netweight
        ,shiftcode
        ,loadshiftcode
        ,loaddatetime
        ,emptydatetime
        ,loadkatacode
        ,katacode
        ,loadusercode
        ,emptyusercode
        ,flag
        ,dieseldistance
        ,dieselquantity
        from weightslip where 
        transactionnumber = ".$this->invl($this->transactionnumber,true)."
        ";
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
                $this->transactionnumber = $row['TRANSACTIONNUMBER'];
                $this->seasoncode = $row['SEASONCODE'];
                $this->weightslipnumber = $row['WEIGHTSLIPNUMBER'];
                $this->fieldslipnumber = $row['FIELDSLIPNUMBER'];
                $this->fieldslip = $row['FIELDSLIPNUMBER'];
                $this->tokentransactionnumber = $row['TOKENTRANSACTIONNUMBER'];
                $caneyardtoken1 = new caneyardtoken($this->connection);
                $caneyardtoken1->transactionnumber = $this->tokentransactionnumber;
                $caneyardtoken1->fetch();
                $this->caneyardtoken = $caneyardtoken1->tokennumberprefix;
                
                $fieldslip1 = new fieldslip($this->connection);
                $fieldslip1->seasoncode = $this->seasoncode;
                $fieldslip1->fieldslipnumber = $this->fieldslipnumber;
                $fieldslip1->fetch();
                $this->farmercode = $fieldslip1->farmercode;
                $this->farmer = $fieldslip1->farmer;
                $this->vehicle = $fieldslip1->vehicle;
                $this->vehiclecode = $fieldslip1->vehiclecode;
                $this->tyregadi = $fieldslip1->tyregadi;
                $this->tyregadicode = $fieldslip1->tyregadicode;
                $this->container = $fieldslip1->container;
                $this->layer = $fieldslip1->layer;
                if ($row['WEIGHMENTDATE']!='')
                {
                    $this->weighmentdate = DateTime::createFromFormat('d-M-y',$row['WEIGHMENTDATE'])->format('d/m/Y');
                }
                else
                {
                    $this->weighmentdate = '';
                }
                if ($row['LOADWEIGHMENTDATE']!='')
                {
                    $this->loadweighmentdate = DateTime::createFromFormat('d-M-y',$row['LOADWEIGHMENTDATE'])->format('d/m/Y');
                }
                else
                {
                    $this->loadweighmentdate = '';
                }
                $this->loadweight = number_format($row['LOADWEIGHT'],3);
                $this->emptyweight = number_format($row['EMPTYWEIGHT'],3);
                $this->bindingmaterial = number_format($row['BINDINGMATERIAL'],3);
                $this->netweight = number_format($row['NETWEIGHT'],3);
                $this->shiftcode = $row['SHIFTCODE'];
                $this->loadshiftcode = $row['LOADSHIFTCODE'];
                //$this->loaddatetime = DateTime::createFromFormat('d-M-y',$row['LOADDATETIME'])->format('d/m/Y');
                //$this->emptydatetime = DateTime::createFromFormat('d-M-y',$row['emptyDATETIME'])->format('d/m/Y');
                $this->loadkatacode = $row['LOADKATACODE'];
                $this->katacode = $row['KATACODE'];
                $this->loadusercode = $row['LOADUSERCODE'];
                $this->emptyusercode = $row['EMPTYUSERCODE'];
                $this->flag = $row['FLAG'];
                if ($row['DIESELQUANTITY']=='' or $row['DIESELQUANTITY']=='0')
                {
                    $query = "select getdieseldistance(t.seasoncode,t.fieldslipnumber) dieseldistance,getdieselquantity(t.seasoncode,t.fieldslipnumber) dieselquantity
                    from (
                    select t.seasoncode,t.fieldslipnumber
                    from FIELDSLIP t 
                    where seasoncode={$this->seasoncode} and t.fieldslipnumber={$this->fieldslipnumber}) t";
                    $result = oci_parse($this->connection, $query);
                    $r = oci_execute($result);
                    if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
                    {
                        $this->dieseldistance=$row['DIESELDISTANCE'];
                        $this->dieselquantity=$row['DIESELQUANTITY'];
                    }
                }
                else
                {
                    $this->dieseldistance=$row['DIESELDISTANCE'];
                    $this->dieselquantity=$row['DIESELQUANTITY'];
                }
                $this->found=true;
                return true;
        }
        else
        {
        return false;
        }
    }
    public function weightfetchonoff($onoff)
    {
        $query = "
        update kata set 
        isallowed = ".$onoff.",
        weight=null
        where 
        katacode = ".$this->invl($_SESSION['katacode'],true)."
        ";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            return 1;
        }
            else
        {
            return 0;
        }
    }
}
?>

