<?php
//This is generated by Swapp Software Application on 28/05/2019 07:19:54 PM for PHP
require_once("../swappbase/formbase.php");
require_once("../ip_model/farmer_db_oracle.php");
require_once("../ip_model/village_db_oracle.php");
require_once("../ip_model/subvillage_db_oracle.php");
class plantationheader extends swappform
{
    Public $seasoncode;
    Public $plotnumber;
    Public $registrationcategorycode;
    Public $plotregistrationdate;
    Public $farmercode;
    Public $villagecode;
    Public $subvillagecode;
    Public $refformnumber;
    Public $gutnumber;
    Public $varietycode;
    Public $plantationhangamcode;
    Public $plantationsubhangamcode;
    Public $plantationdate;
    Public $area;
    Public $irrigationsourcecode;
    Public $irrigationmethodcode;
    Public $plantationcategorycode;
    Public $caneseedcategorycode;
    Public $watekaricode;
    Public $watacode;
    Public $flag;
    Public $farmer;
    Public $village;
    Public $subvillage;
    Public $watekari;
	Public $areabygps;
	Public $farmercategorycode;
	Public $farmercategory;
	Public $membervillagecode;
	Public $membervillage;
	Public $plantationmethodcode;
	Public $caneseedsourcecode;
	Public $refplotnumber;
	Public $slipboycode;
	Public $fertilisercode;
	Public $mobilenumber;
	Public $adharnumber;
	Public $overshareapprstatus;
	Public $allowedforharvesting;
    public function __construct(&$connection)
    {
     		 parent::__construct($connection);
         $this->seasoncode='';
         $this->plotnumber='';
         $this->registrationcategorycode='';
         $this->plotregistrationdate='';
         $this->farmercode='';
         $this->villagecode='';
         $this->subvillagecode='';
         $this->refformnumber='';
         $this->gutnumber='';
         $this->varietycode='';
         $this->plantationhangamcode='';
         $this->plantationsubhangamcode='';
         $this->plantationdate='';
         $this->area='';
         $this->irrigationsourcecode='';
         $this->irrigationmethodcode='';
         $this->plantationcategorycode='';
         $this->caneseedcategorycode='';
         $this->watekaricode='';
         $this->watacode='';
         $this->flag='';
	   }
    public function entryvalidation()
    {
		$this->start_validation();
		$this->checkrequired($this->registrationcategorycode,'Registration Category');
        $this->checkrequired($this->farmercode,'Farmer');
        $this->checkrequired($this->villagecode,'Village');
        //$this->checkrequired($this->refformnumber,'Form number');
        $this->checkrequired($this->gutnumber,'Gat number');
        $this->checkrequired($this->varietycode,'Variety');
        $this->checkrequired($this->plantationhangamcode,'Hangam');
        $this->checkrequired($this->plantationdate,'Plantation Date');
		$this->checkrequired($this->area,'Area');
		$this->checkrequired($this->plantationmethodcode,'Plantation Method');
		$this->checkrequired($this->caneseedsourcecode,'Cane Seed Source');
        $this->checkrequired($this->irrigationsourcecode,'Irrigation Source');
		$this->checkrequired($this->plantationcategorycode,'Plantation Categoty');
		if ($this->area>10 or $this->area<0)
		{
			$this->invalidid=-200;
			$this->invalidmessagetext='Invalid Area';
			$this->end_validation();
			return $this->invalidid;
			exit;
		}
		if ($this->mobilenumber != '')
		{
			if (strlen($this->mobilenumber) != 10)
			{	
				$this->invalidid=-200;
				$this->invalidmessagetext='Invalid Mobile Number';
				$this->end_validation();
        		return $this->invalidid;
				exit;
			}
		}
		if ($this->adharnumber != '')
		{
			if (strlen($this->adharnumber) != 12)
			{	
				$this->invalidid=-200;
				$this->invalidmessagetext='Invalid Adhar Number';
				$this->end_validation();
        		return $this->invalidid;
				exit;
			}
		}
        $this->end_validation();
        return $this->invalidid;
	  }
    private function datavalidation()
    {
		$this->start_validation();
		$query = "select 1 as flag from dual where sysdate <= to_date('".DateTime::createFromFormat('d/m/Y',$this->plantationdate)->format('d-M-Y')."')";
		$result = oci_parse($this->connection, $query);
		$r = oci_execute($result);
		$row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
		if ($row["FLAG"]==1)
		{
			$this->invalidid=-200;
			$this->invalidmessagetext='Plantation Date should be less than todays date!';	
		}
		else
		{
			$this->invalidid=0;
			$this->invalidmessagetext='Validated';
		}
		$this->end_validation();
		return $this->invalidid;
    }
    public function insert()
    {
        $this->dataoperationmode = operationmode::Insert;
	    if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
	    if ($this->plotnumber == '')
        {
            $query = "select nvl(max(plotnumber),0)+1 as plotnumber 
            from plantationheader
            where seasoncode=".$this->seasoncode;
            $result = oci_parse($this->connection, $query);
            $r = oci_execute($result);
            $row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
            $this->plotnumber = $row["PLOTNUMBER"];
        }
        if ($this->plantationdate!='')
        {
            $this->plantationdate = DateTime::createFromFormat('d/m/Y',$this->plantationdate)->format('d-M-Y');
		}
		
        $query = "
            insert into plantationheader(
            seasoncode
            ,plotnumber
            ,registrationcategorycode
            ,farmercode
            ,villagecode
            ,subvillagecode
            ,refformnumber
            ,gutnumber
            ,varietycode
            ,plantationhangamcode
            ,plantationdate
            ,area
            ,irrigationsourcecode
            ,irrigationmethodcode
            ,plantationcategorycode
            ,caneseedcategorycode
            ,watekaricode
			,watacode
			,plantationmethodcode
			,caneseedsourcecode
			,refplotnumber
			,slipboycode
			,fertilisercode
            ,flag
	        )
	        values (
            ".$this->invl($this->seasoncode,true)."
            ,".$this->invl($this->plotnumber,true)."
            ,".$this->invl($this->registrationcategorycode,true)."
            ,".$this->invl($this->farmercode,true,true)."
            ,".$this->invl($this->villagecode,true,true)."
            ,".$this->invl($this->subvillagecode,true,true)."
            ,".$this->invl($this->refformnumber,false)."
            ,".$this->invl($this->gutnumber,false)."
            ,".$this->invl($this->varietycode,true,true)."
            ,".$this->invl($this->plantationhangamcode,true,true)."
            ,".$this->invl($this->plantationdate,false)."
            ,".$this->invl($this->area,true)."
            ,".$this->invl($this->irrigationsourcecode,true,true)."
            ,".$this->invl($this->irrigationmethodcode,true,true)."
            ,".$this->invl($this->plantationcategorycode,true,true)."
            ,".$this->invl($this->caneseedcategorycode,true,true)."
            ,".$this->invl($this->watekaricode,true,true)."
			,".$this->invl($this->watacode,true,true)."
			,".$this->invl($this->plantationmethodcode,true,true)."
			,".$this->invl($this->caneseedsourcecode,true,true)."
			,".$this->invl($this->refplotnumber,true,true)."
			,".$_SESSION['usersid']."
			,".$this->invl($this->fertilisercode,true,true)."
            ,".$this->invl($this->flag,true)."
            )";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
			$query1 = "
			update farmer set 
			mobilenumber = ".$this->invl($this->mobilenumber,true)."
			,adharnumber = ".$this->invl($this->adharnumber,true)."
			where farmercode = ".$this->invl($this->farmercode,true);
			$result1 = oci_parse($this->connection, $query1);
			if (oci_execute($result1,OCI_NO_AUTO_COMMIT))
			{
				return 1;
				exit;
			}
			else
			{
				return 0;
				exit;
			}
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function display()
	  {
		    $this->dataoperationmode = operationmode::Select;
		    $cond='';
		    if ($this->seasoncode!='' and $this->seasoncode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.seasoncode = ".$this->seasoncode;
			       }
			       else
			       {
				         $cond=$cond." and t.seasoncode = ".$this->seasoncode;
			       }
		    }
		    if ($this->plotnumber!='' and $this->plotnumber!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.plotnumber = ".$this->plotnumber;
			       }
			       else
			       {
				         $cond=$cond." and t.plotnumber = ".$this->plotnumber;
			       }
		    }
		    if ($this->registrationcategorycode!='' and $this->registrationcategorycode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.registrationcategorycode = ".$this->registrationcategorycode;
			       }
			       else
			       {
				         $cond=$cond." and t.registrationcategorycode = ".$this->registrationcategorycode;
			       }
		    }
		    if ($this->plotregistrationdate!='')
		    {
			      $this->plotregistrationdate = DateTime::createFromFormat('d/m/Y',$this->plotregistrationdate)->format('d-M-Y');
			      if ($cond=='')
			      {
				        $cond="t.plotregistrationdate = '".$this->plotregistrationdate."'";
			       }
			       else
			       {
				         $cond=$cond." and t.plotregistrationdate = '".$this->plotregistrationdate."'";
			       }
		    }
		    if ($this->farmercode!='' and $this->farmercode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.farmercode = ".$this->farmercode;
			       }
			       else
			       {
				         $cond=$cond." and t.farmercode = ".$this->farmercode;
			       }
		    }
		    if ($this->villagecode!='' and $this->villagecode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.villagecode = ".$this->villagecode;
			       }
			       else
			       {
				         $cond=$cond." and t.villagecode = ".$this->villagecode;
			       }
		    }
		    if ($this->refformnumber!='')
		    {
			      if ($cond=='')
			      {
				        $cond="t.refformnumber like '%".$this->refformnumber."%'";
			       }
			       else
			       {
				         $cond=$cond." and t.refformnumber like '%".$this->refformnumber."%'";
			       }
		    }
		    if ($this->gutnumber!='')
		    {
			      if ($cond=='')
			      {
				        $cond="t.gutnumber like '%".$this->gutnumber."%'";
			       }
			       else
			       {
				         $cond=$cond." and t.gutnumber like '%".$this->gutnumber."%'";
			       }
		    }
		    if ($this->varietycode!='' and $this->varietycode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.varietycode = ".$this->varietycode;
			       }
			       else
			       {
				         $cond=$cond." and t.varietycode = ".$this->varietycode;
			       }
		    }
		    if ($this->plantationhangamcode!='' and $this->plantationhangamcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.plantationhangamcode = ".$this->plantationhangamcode;
			       }
			       else
			       {
				         $cond=$cond." and t.plantationhangamcode = ".$this->plantationhangamcode;
			       }
		    }
		    if ($this->plantationsubhangamcode!='' and $this->plantationsubhangamcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.plantationsubhangamcode = ".$this->plantationsubhangamcode;
			       }
			       else
			       {
				         $cond=$cond." and t.plantationsubhangamcode = ".$this->plantationsubhangamcode;
			       }
		    }
		    if ($this->plantationdate!='')
		    {
			      $this->plantationdate = DateTime::createFromFormat('d/m/Y',$this->plantationdate)->format('d-M-Y');
			      if ($cond=='')
			      {
				        $cond="t.plantationdate = '".$this->plantationdate."'";
			       }
			       else
			       {
				         $cond=$cond." and t.plantationdate = '".$this->plantationdate."'";
			       }
		    }
		    if ($this->area!='' and $this->area!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.area = ".$this->area;
			       }
			       else
			       {
				         $cond=$cond." and t.area = ".$this->area;
			       }
		    }
		    if ($this->irrigationsourcecode!='' and $this->irrigationsourcecode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.irrigationsourcecode = ".$this->irrigationsourcecode;
			       }
			       else
			       {
				         $cond=$cond." and t.irrigationsourcecode = ".$this->irrigationsourcecode;
			       }
		    }
		    if ($this->irrigationmethodcode!='' and $this->irrigationmethodcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.irrigationmethodcode = ".$this->irrigationmethodcode;
			       }
			       else
			       {
				         $cond=$cond." and t.irrigationmethodcode = ".$this->irrigationmethodcode;
			       }
		    }
		    if ($this->plantationcategorycode!='' and $this->plantationcategorycode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.plantationcategorycode = ".$this->plantationcategorycode;
			       }
			       else
			       {
				         $cond=$cond." and t.plantationcategorycode = ".$this->plantationcategorycode;
			       }
		    }
		    if ($this->caneseedcategorycode!='' and $this->caneseedcategorycode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.caneseedcategorycode = ".$this->caneseedcategorycode;
			       }
			       else
			       {
				         $cond=$cond." and t.caneseedcategorycode = ".$this->caneseedcategorycode;
			       }
		    }
		    if ($this->watekaricode!='' and $this->watekaricode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.watekaricode = ".$this->watekaricode;
			       }
			       else
			       {
				         $cond=$cond." and t.watekaricode = ".$this->watekaricode;
			       }
		    }
		    if ($this->watacode!='' and $this->watacode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.watacode = ".$this->watacode;
			       }
			       else
			       {
				         $cond=$cond." and t.watacode = ".$this->watacode;
			       }
			}
			if ($this->plantationmethodcode!='' and $this->plantationmethodcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.plantationmethodcode = ".$this->plantationmethodcode;
			       }
			       else
			       {
				         $cond=$cond." and t.plantationmethodcode = ".$this->plantationmethodcode;
			       }
			}
			if ($this->caneseedsourcecode!='' and $this->caneseedsourcecode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.caneseedsourcecode = ".$this->caneseedsourcecode;
			       }
			       else
			       {
				         $cond=$cond." and t.caneseedsourcecode = ".$this->caneseedsourcecode;
			       }
			}
			if ($this->refplotnumber!='' and $this->refplotnumber!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.refplotnumber = ".$this->refplotnumber;
			       }
			       else
			       {
				         $cond=$cond." and t.refplotnumber = ".$this->refplotnumber;
			       }
			}
			if ($this->slipboycode!='' and $this->slipboycode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.slipboycode = ".$this->slipboycode;
			       }
			       else
			       {
				         $cond=$cond." and t.slipboycode = ".$this->slipboycode;
			       }
			}
        if ($cond!='')
		    {
				$query = "select t.*,v.varietynameuni,h.plantationhangamnameuni
				,v.varietynameeng,h.plantationhangamnameeng
				,area 
				from plantationheader t,variety v,plantationhangam h
				where t.varietycode=v.varietycode
				and t.plantationhangamcode=h.plantationhangamcode 
				and ".$cond." order by seasoncode,plotnumber";
			    $result = oci_parse($this->connection, $query);
            	$r = oci_execute($result);
			    return $result;
		    }
		    else
		    {
				$query = "select t.*,v.varietynameuni,h.plantationhangamnameuni 
				,v.varietynameeng,h.plantationhangamnameeng
				,area
				from plantationheader t,variety v,plantationhangam h
				where t.varietycode=v.varietycode
				and t.plantationhangamcode=h.plantationhangamcode 
				order by seasoncode,plotnumber";
			    $result = oci_parse($this->connection, $query);
             	$r = oci_execute($result);
			    return $result;
		    }
	  }
    public function update()
    {
        $this->dataoperationmode = operationmode::Update;
        if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
        $this->plotregistrationdate = DateTime::createFromFormat('d/m/Y',$this->plotregistrationdate)->format('d-M-Y');
        $this->plantationdate = DateTime::createFromFormat('d/m/Y',$this->plantationdate)->format('d-M-Y');
        
		$query = "
        update plantationheader set 
        registrationcategorycode = ".$this->invl($this->registrationcategorycode,true)."
        ,plotregistrationdate =".$this->invl($this->plotregistrationdate,false)."
        ,farmercode = ".$this->invl($this->farmercode,true)."
        ,villagecode = ".$this->invl($this->villagecode,true)."
        ,subvillagecode = ".$this->invl($this->subvillagecode,true)."
        ,refformnumber =".$this->invl($this->refformnumber,false)."
        ,gutnumber =".$this->invl($this->gutnumber,false)."
        ,varietycode = ".$this->invl($this->varietycode,true)."
        ,plantationhangamcode = ".$this->invl($this->plantationhangamcode,true)."
        ,plantationdate =".$this->invl($this->plantationdate,false)."
        ,area = ".$this->invl($this->area,true)."
        ,irrigationsourcecode = ".$this->invl($this->irrigationsourcecode,true)."
        ,irrigationmethodcode = ".$this->invl($this->irrigationmethodcode,true)."
        ,plantationcategorycode = ".$this->invl($this->plantationcategorycode,true)."
        ,caneseedcategorycode = ".$this->invl($this->caneseedcategorycode,true)."
		,plantationmethodcode = ".$this->invl($this->plantationmethodcode,true)."
		,caneseedsourcecode = ".$this->invl($this->caneseedsourcecode,true)."
		,refplotnumber = ".$this->invl($this->refplotnumber,true)."
		,fertilisercode = ".$this->invl($this->fertilisercode,true)."
        ,flag = ".$this->invl($this->flag,true)."
		,allowedforharvesting = ".$this->invl($this->allowedforharvesting,true,true)."
		where 
        seasoncode = ".$this->invl($this->seasoncode,true)."
        and plotnumber = ".$this->invl($this->plotnumber,true)."
        ";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            $query1 = "
			update farmer set 
			mobilenumber = ".$this->invl($this->mobilenumber,true)."
			,adharnumber = ".$this->invl($this->adharnumber,true)."
			where farmercode = ".$this->invl($this->farmercode,true);
			$result1 = oci_parse($this->connection, $query1);
			if (oci_execute($result1,OCI_NO_AUTO_COMMIT))
			{
				return 1;
				exit;
			}
			else
			{
				return 0;
				exit;
			}
        }
            else
        {
            return 0;
            exit;
        }
    }
    public function delete()
    {
        $this->dataoperationmode = operationmode::Delete;
        if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
        $this->plotregistrationdate = DateTime::createFromFormat('d/m/Y',$this->plotregistrationdate)->format('d-M-Y');
        $this->plantationdate = DateTime::createFromFormat('d/m/Y',$this->plantationdate)->format('d-M-Y');
        $query = "
        delete from plantationheader
        where 
        seasoncode = ".$this->invl($this->seasoncode,true)."
        and plotnumber = ".$this->invl($this->plotnumber,true)."
        ";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
             return 1;
             exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function fetch()
    {
        $this->dataoperationmode = operationmode::Select;
        $query = "select 
        seasoncode
        ,plotnumber
        ,registrationcategorycode
        ,plotregistrationdate
        ,farmercode
        ,villagecode
        ,subvillagecode
        ,refformnumber
        ,gutnumber
        ,varietycode
        ,plantationhangamcode
        ,plantationdate
        ,area
        ,irrigationsourcecode
        ,irrigationmethodcode
        ,plantationcategorycode
        ,caneseedcategorycode
        ,watekaricode
        ,watacode
        ,flag
		,areabygps
		,plantationmethodcode
		,caneseedsourcecode
		,refplotnumber
		,fertilisercode
		,overshareapprstatus
		,allowedforharvesting
        from plantationheader where 
        seasoncode = ".$this->invl($this->seasoncode,true)."
         and plotnumber = ".$this->invl($this->plotnumber,true)."
        ";
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
                $this->seasoncode = $row['SEASONCODE'];
                $this->plotnumber = $row['PLOTNUMBER'];
                $this->registrationcategorycode = $row['REGISTRATIONCATEGORYCODE'];
                $this->plotregistrationdate = DateTime::createFromFormat('d-M-y',$row['PLOTREGISTRATIONDATE'])->format('d/m/Y');
                $this->farmercode = $row['FARMERCODE'];
                $this->villagecode = $row['VILLAGECODE'];
                $this->subvillagecode = $row['SUBVILLAGECODE'];
                $this->refformnumber = $row['REFFORMNUMBER'];
                $this->gutnumber = $row['GUTNUMBER'];
                $this->varietycode = $row['VARIETYCODE'];
                $this->plantationhangamcode = $row['PLANTATIONHANGAMCODE'];
                $this->plantationdate = DateTime::createFromFormat('d-M-y',$row['PLANTATIONDATE'])->format('d/m/Y');
                $this->area = sprintf("%0.2f", $row['AREA']);
                $this->irrigationsourcecode = $row['IRRIGATIONSOURCECODE'];
                $this->irrigationmethodcode = $row['IRRIGATIONMETHODCODE'];
                $this->plantationcategorycode = $row['PLANTATIONCATEGORYCODE'];
                $this->caneseedcategorycode = $row['CANESEEDCATEGORYCODE'];
                $this->watekaricode = $row['WATEKARICODE'];
                $this->watacode = $row['WATACODE'];
                $this->flag = $row['FLAG'];
				$this->areabygps = $row['AREABYGPS'];
				$this->plantationmethodcode = $row['PLANTATIONMETHODCODE'];
				$this->caneseedsourcecode = $row['CANESEEDSOURCECODE'];
				$this->refplotnumber = $row['REFPLOTNUMBER'];
				$this->fertilisercode = $row['FERTILISERCODE'];
				$this->overshareapprstatus=$row['OVERSHAREAPPRSTATUS'];
				$this->allowedforharvesting=$row['ALLOWEDFORHARVESTING'];
				$farmer1 = new farmer($this->connection);
                $farmer1->farmercode = $this->farmercode;
                $farmer1->fetch();
                if ($_SESSION['lng']=="English")
                {
					$this->farmer = $farmer1->farmernameeng;
                }
                else
                {
                    $this->farmer = $farmer1->farmernameuni;
				}
				$this->farmercategorycode=$farmer1->farmercategorycode;
				$this->farmercategory=$farmer1->farmercategory;
				$this->adharnumber=$farmer1->adharnumber;
				$this->mobilenumber=$farmer1->mobilenumber;
				$this->membervillagecode=$farmer1->villagecode;
				$this->membervillage=$farmer1->village;
                $farmer2 = new farmer($this->connection);
                $farmer2->farmercode = $this->watekaricode;
                $farmer2->fetch();
                if ($_SESSION['lng']=="English")
                {
                    $this->watekari = $farmer2->farmernameeng;
                }
                else
                {
                    $this->watekari = $farmer2->farmernameuni;
                }
                $village1 = new village($this->connection);
                $village1->villagecode = $this->villagecode;
                $village1->fetch();
                if ($_SESSION['lng']=="English")
                {
                    $this->village = $village1->villagenameeng;
                }
                else
                {
                    $this->village = $village1->villagenameuni;
                }
                $subvillage1 = new subvillage($this->connection);
                $subvillage1->villagecode = $this->villagecode;
                $subvillage1->subvillagecode = $this->subvillagecode;
                $subvillage1->fetch();
                if ($_SESSION['lng']=="English")
                {
                    $this->subvillage = $subvillage1->subvillagenameeng;
                }
                else
                {
                    $this->subvillage = $subvillage1->subvillagenameuni;
                }
                $this->found=true;
                return true;
        }
        else
        {
        return false;
        }
    }
    public function select()
	  {
		    $this->dataoperationmode = operationmode::Select;
		    $cond='';
		    if ($this->seasoncode!='' and $this->seasoncode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.seasoncode = ".$this->seasoncode;
			       }
			       else
			       {
				         $cond=$cond." and t.seasoncode = ".$this->seasoncode;
			       }
		    }
		    if ($this->plotnumber!='' and $this->plotnumber!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.plotnumber = ".$this->plotnumber;
			       }
			       else
			       {
				         $cond=$cond." and t.plotnumber = ".$this->plotnumber;
			       }
		    }
/* 		    if ($this->registrationcategorycode!='' and $this->registrationcategorycode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.registrationcategorycode = ".$this->registrationcategorycode;
			       }
			       else
			       {
				         $cond=$cond." and t.registrationcategorycode = ".$this->registrationcategorycode;
			       }
		    }
 */		    /* if ($this->plotregistrationdate!='')
		    {
			      $this->plotregistrationdate = DateTime::createFromFormat('d/m/Y',$this->plotregistrationdate)->format('d-M-Y');
			      if ($cond=='')
			      {
				        $cond="t.plotregistrationdate = '".$this->plotregistrationdate."'";
			       }
			       else
			       {
				         $cond=$cond." and t.plotregistrationdate = '".$this->plotregistrationdate."'";
			       }
		    } */
		    if ($this->farmercode!='' and $this->farmercode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.farmercode = ".$this->farmercode;
			       }
			       else
			       {
				         $cond=$cond." and t.farmercode = ".$this->farmercode;
			       }
		    }
		    if ($this->villagecode!='' and $this->villagecode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.villagecode = ".$this->villagecode;
			       }
			       else
			       {
				         $cond=$cond." and t.villagecode = ".$this->villagecode;
			       }
		    }
		    if ($this->refformnumber!='')
		    {
			      if ($cond=='')
			      {
				        $cond="t.refformnumber like '%".$this->refformnumber."%'";
			       }
			       else
			       {
				         $cond=$cond." and t.refformnumber like '%".$this->refformnumber."%'";
			       }
		    }
		    if ($this->gutnumber!='')
		    {
			      if ($cond=='')
			      {
				        $cond="t.gutnumber like '%".$this->gutnumber."%'";
			       }
			       else
			       {
				         $cond=$cond." and t.gutnumber like '%".$this->gutnumber."%'";
			       }
		    }
		    if ($this->varietycode!='' and $this->varietycode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.varietycode = ".$this->varietycode;
			       }
			       else
			       {
				         $cond=$cond." and t.varietycode = ".$this->varietycode;
			       }
		    }
		    if ($this->plantationhangamcode!='' and $this->plantationhangamcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.plantationhangamcode = ".$this->plantationhangamcode;
			       }
			       else
			       {
				         $cond=$cond." and t.plantationhangamcode = ".$this->plantationhangamcode;
			       }
		    }
		    if ($this->plantationsubhangamcode!='' and $this->plantationsubhangamcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.plantationsubhangamcode = ".$this->plantationsubhangamcode;
			       }
			       else
			       {
				         $cond=$cond." and t.plantationsubhangamcode = ".$this->plantationsubhangamcode;
			       }
		    }
		    /* if ($this->plantationdate!='')
		    {
			      $this->plantationdate = DateTime::createFromFormat('d/m/Y',$this->plantationdate)->format('d-M-Y');
			      if ($cond=='')
			      {
				        $cond="t.plantationdate = '".$this->plantationdate."'";
			       }
			       else
			       {
				         $cond=$cond." and t.plantationdate = '".$this->plantationdate."'";
			       }
		    } */
		    /* if ($this->area!='' and $this->area!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.area = ".$this->area;
			       }
			       else
			       {
				         $cond=$cond." and t.area = ".$this->area;
			       }
		    } */
		    if ($this->irrigationsourcecode!='' and $this->irrigationsourcecode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.irrigationsourcecode = ".$this->irrigationsourcecode;
			       }
			       else
			       {
				         $cond=$cond." and t.irrigationsourcecode = ".$this->irrigationsourcecode;
			       }
		    }
		    if ($this->irrigationmethodcode!='' and $this->irrigationmethodcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.irrigationmethodcode = ".$this->irrigationmethodcode;
			       }
			       else
			       {
				         $cond=$cond." and t.irrigationmethodcode = ".$this->irrigationmethodcode;
			       }
		    }
		    if ($this->plantationcategorycode!='' and $this->plantationcategorycode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.plantationcategorycode = ".$this->plantationcategorycode;
			       }
			       else
			       {
				         $cond=$cond." and t.plantationcategorycode = ".$this->plantationcategorycode;
			       }
		    }
		    if ($this->caneseedcategorycode!='' and $this->caneseedcategorycode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.caneseedcategorycode = ".$this->caneseedcategorycode;
			       }
			       else
			       {
				         $cond=$cond." and t.caneseedcategorycode = ".$this->caneseedcategorycode;
			       }
		    }
		    if ($this->watekaricode!='' and $this->watekaricode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.watekaricode = ".$this->watekaricode;
			       }
			       else
			       {
				         $cond=$cond." and t.watekaricode = ".$this->watekaricode;
			       }
		    }
		    if ($this->watacode!='' and $this->watacode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.watacode = ".$this->watacode;
			       }
			       else
			       {
				         $cond=$cond." and t.watacode = ".$this->watacode;
			       }
			}
			if ($this->watacode!='' and $this->watacode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.watacode = ".$this->watacode;
			       }
			       else
			       {
				         $cond=$cond." and t.watacode = ".$this->watacode;
			       }
			}
			if ($this->plantationmethodcode!='' and $this->plantationmethodcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.plantationmethodcode = ".$this->plantationmethodcode;
			       }
			       else
			       {
				         $cond=$cond." and t.plantationmethodcode = ".$this->plantationmethodcode;
			       }
			}
			if ($this->caneseedsourcecode!='' and $this->caneseedsourcecode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.caneseedsourcecode = ".$this->caneseedsourcecode;
			       }
			       else
			       {
				         $cond=$cond." and t.caneseedsourcecode = ".$this->caneseedsourcecode;
			       }
			}
			if ($this->refplotnumber!='' and $this->refplotnumber!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.refplotnumber = ".$this->refplotnumber;
			       }
			       else
			       {
				         $cond=$cond." and t.refplotnumber = ".$this->refplotnumber;
			       }
			}
			if ($this->slipboycode!='' and $this->slipboycode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.slipboycode = ".$this->slipboycode;
			       }
			       else
			       {
				         $cond=$cond." and t.slipboycode = ".$this->slipboycode;
			       }
			}
        /* if ($cond!='')
		    {
				$query = "select t.plotnumber,v.villagenameuni,f.farmernameuni,t.gutnumber FROM plantationheader t, farmer f,village v where t.farmercode=f.farmercode and t.villagecode=v.villagecode 
				and v.centrecode in (select c.centrecode from slipboy s,slipboycentre c,slipboyresponsibility r 
				where s.slipboycode=r.slipboycode and r.uptodate is null 
				and s.slipboycode=c.slipboycode and c.uptodate is null 
				and ".$cond;
			      $result = oci_parse($this->connection, $query);
            $r = oci_execute($result);
			      return $result;
		     }
		     else
		     {
				 $query = "select t.plotnumber,v.villagenameuni,f.farmernameuni,t.gutnumber FROM plantationheader t, farmer f,village v where t.farmercode=f.farmercode and t.villagecode=v.villagecode 
				 and v.centrecode in (select c.centrecode from slipboy s,slipboycentre c,slipboyresponsibility r 
				 where s.slipboycode=r.slipboycode and r.uptodate is null 
				 and s.slipboycode=c.slipboycode and c.uptodate is null 
				 order by t.seasoncode,t.plotnumber";
			       $result = oci_parse($this->connection, $query);
             $r = oci_execute($result);
			       return $result;
			 } */
			 
			 if ($cond!='')
		    {
				$query = "select t.plotnumber,v.villagenameuni,f.farmernameuni,t.gutnumber FROM plantationheader t, farmer f,village v where t.farmercode=f.farmercode and t.villagecode=v.villagecode 
				and v.centrecode in (select c.centrecode from slipboy s,slipboycentre c,slipboyresponsibility r 
				where s.slipboycode=r.slipboycode and r.uptodate is null 
				and s.slipboycode=c.slipboycode and c.uptodate is null 
				and s.userid=".$_SESSION['usersid'].") and ".$cond."
				 and isselfieuploaded is null order by t.seasoncode,t.plotnumber";
			      $result = oci_parse($this->connection, $query);
            	$r = oci_execute($result);
			      return $result;
		     }
		     else
		     {
				 $query = "select t.plotnumber,v.villagenameuni,f.farmernameuni,t.gutnumber FROM plantationheader t, farmer f,village v where t.farmercode=f.farmercode and t.villagecode=v.villagecode 
				 and v.centrecode in (select c.centrecode from slipboy s,slipboycentre c,slipboyresponsibility r 
				 where s.slipboycode=r.slipboycode and r.uptodate is null 
				 and s.slipboycode=c.slipboycode and c.uptodate is null 
				 and s.userid=".$_SESSION['usersid'].") and isselfieuploaded is null order by t.seasoncode,t.plotnumber";
			       $result = oci_parse($this->connection, $query);
             	$r = oci_execute($result);
				   return $result;
			 }
	  }
	  public function insertselected($plotnumber)
	  {
		  $query = "
			  insert into measurementplot(
			  seasoncode
			  ,plotnumber
			  ,measurementuserid
			  )
			  values (
			  ".$_SESSION['yearperiodcode']."
			  ,".$this->invl($plotnumber,true)."
			  ,".$_SESSION["usersid"]."
			  )";
		  $result = oci_parse($this->connection, $query);
		  if (oci_execute($result,OCI_NO_AUTO_COMMIT))
		  {
			  return 1;
			  exit;
		  }
		  else
		  {
			  return 0;
			  exit;
		  }
	    }  
		public function selectedlist()
		{
			$query = "select t.plotnumber,v.villagenameuni,f.farmernameuni,t.gutnumber FROM plantationheader t, farmer f,village v where t.farmercode=f.farmercode and t.villagecode=v.villagecode and nvl(t.areabygps,0)=0 and 
				  (t.seasoncode,t.plotnumber) in (select m.seasoncode,m.plotnumber from measurementplot m where m.measurementuserid=".$_SESSION["usersid"].") order by t.seasoncode,t.plotnumber";
			$result = oci_parse($this->connection, $query);
            $r = oci_execute($result);
			return $result;
		}
		public function unverifiedlist()
		{
			$query = "select t.seasoncode,t.plotnumber,v.villagenameuni,f.farmernameuni,t.gutnumber FROM plantationheader t, farmer f,village v 
			where t.farmercode=f.farmercode and t.villagecode=v.villagecode 
			and (t.overshareapprstatus is null or t.overshareapprstatus=0) and nvl(t.areabygps,0)<>0
			and v.centrecode in (select c.centrecode from slipboy s,slipboycentre c,slipboyresponsibility r 
			where s.slipboycode=r.slipboycode and r.uptodate is null 
			and s.slipboycode=c.slipboycode and c.uptodate is null 
			and r.responsibilitycode=123981247
			and s.userid=".$_SESSION['usersid'].") 
			order by t.seasoncode,v.villagenameuni,f.farmernameuni,t.gutnumber,t.plotnumber";
			$result = oci_parse($this->connection, $query);
            $r = oci_execute($result);
			return $result;
		}   
		public function verified()
	  	{
		  	$query = "
			update plantationheader
			set overshareapprstatus=1
			,oversharecode=".$_SESSION['usersid']."
			,overshareapprdate=sysdate 
			where 
			seasoncode = ".$this->invl($this->seasoncode,true)."
			and plotnumber = ".$this->invl($this->plotnumber,true).
			" and nvl(overshareapprstatus,0)=0";
			$result = oci_parse($this->connection, $query);
			if (oci_execute($result,OCI_NO_AUTO_COMMIT))
			{
				return 1;
				exit;
			}
			else
			{
				return 0;
				exit;
			}
	    }  
}
?>

