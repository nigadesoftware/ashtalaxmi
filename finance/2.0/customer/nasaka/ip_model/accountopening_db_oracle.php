<?php
//This is generated by Nigade Software Technologies (opc) Private Limited 02/11/2022 10:32:19 am for PHP
require_once("../swappbase/formbase.php");
class accountopening extends swappform
{
    Public $yearperiodcode;
    Public $entitycode;
    Public $accountcode;
    Public $accountcodetextcombo;
    Public $subledgercode;
    Public $subledgercodetextcombo;
    Public $debitbalance;
    Public $creditbalance;
    Public $seasonyear;
    public function __construct(&$connection)
    {
     		 parent::__construct($connection);
         $this->yearperiodcode='';
         $this->yearperiodcodetextcombo='';
         $this->entitycode='';
         $this->entitycodetextcombo='';
         $this->accountcode='';
         $this->accountcodetextcombo='';
         $this->subledgercode='';
         $this->subledgercodetextcombo='';
         $this->debitbalance='';
         $this->debitbalancetextcombo='';
         $this->creditbalance='';
         $this->creditbalancetextcombo='';
         $this->seasonyear='';
         $this->seasonyeartextcombo='';
	   }
    public function entryvalidation()
    {
    		$this->start_validation();
       // $this->checkrequired($this->yearperiodcode,'Season Year','सिझन वर्ष');
       // $this->checkrequired($this->entitycode,'Entry Code','Entry Code');
        $this->checkrequired($this->accountcode,'Account Code','अकौंट कोड');
        $this->checkrequired($this->subledgercode,'Sub Ledger','उप कोड');
        //$this->checkrequired($this->debitbalance,'Debit Amount','डेबिट रक्कम');
       // $this->checkrequired($this->creditbalance,'Credit Amount','क्रेडीट रक्कम');
       // $this->checkrequired($this->seasonyear,'year','सिझन');
        $this->end_validation();
        return $this->invalidid;
	  }
    private function datavalidation()
    {
        $this->start_validation();
    		$this->invalidid=0;
    		$this->invalidmessagetext='Validated';
    		$this->end_validation();
    		return $this->invalidid;
    }
    public function insert()
    {
        $this->dataoperationmode = operationmode::Insert;
	    if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
        $query = "
            insert into accountopening(
            yearperiodcode
            ,entitycode
            ,accountcode
            ,subledgercode
            ,debitbalance
            ,creditbalance
            ,seasonyear
	        )
	        values (202220203
            /*".$this->invl($this->yearperiodcode,true)."*/
            ,1/*".$this->invl($this->entitycode,true)."*/
            ,".$this->invl($this->accountcode,true,true)."
            ,".$this->invl($this->subledgercode,true,true)."
            ,".$this->invl($this->debitbalance,true)."
            ,".$this->invl($this->creditbalance,true)."
            ,".$this->invl($this->seasonyear,true)."
            )";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            return 1;
            exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function display()
	  {
		    $this->dataoperationmode = operationmode::Select;
		    $cond='';
		    if ($this->yearperiodcode!='' and $this->yearperiodcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.yearperiodcode = ".$this->yearperiodcode;
			       }
			       else
			       {
				         $cond=$cond." and t.yearperiodcode = ".$this->yearperiodcode;
			       }
		    }
		    if ($this->accountcode!='' and $this->accountcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.accountcode = ".$this->accountcode;
			       }
			       else
			       {
				         $cond=$cond." and t.accountcode = ".$this->accountcode;
			       }
		    }
		    if ($this->subledgercode!='' and $this->subledgercode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.subledgercode = ".$this->subledgercode;
			       }
			       else
			       {
				         $cond=$cond." and t.subledgercode = ".$this->subledgercode;
			       }
		    }
        if ($cond!='')
		    {

		      //  $query = "select t.* from accountopening t where ".$cond;
              $query="
              select (t.accountcode||'-'||a.accountnameuni)accountname
              ,(t.subledgercode||'-'||s.subledgernameuni)subledgername
              ,t.accountcode,t.subledgercode
              from
              accountopening t
              ,accounthead a
              ,accountsubledger s
              where
              ".$cond."
              and t.accountcode=a.accountcode
              and t.accountcode=s.accountcode(+)
              and t.subledgercode=s.subledgercode(+)
              ";
			      $result = oci_parse($this->connection, $query);
                 $r = oci_execute($result);
			      return $result;
                  
		     }
		     else
		     {
		        // $query = "select t.* from accountopening t";
                $query="
              select (t.accountcode||'-'||a.accountnameuni)accountname
              ,(t.subledgercode||'-'||s.subledgernameuni)subledgername
              ,t.accountcode,t.subledgercode
              from 
              accountopening t
              ,accounthead a
              ,accountsubledger s
              where             
               t.accountcode=a.accountcode
               and t.accountcode=s.accountcode(+)
              and t.subledgercode=s.subledgercode(+)
              ";
			       $result = oci_parse($this->connection, $query);
             $r = oci_execute($result);
			       return $result;
		     }
	  }
    public function update()
    {
        $this->dataoperationmode = operationmode::Update;
        if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
        $query = "
        update accountopening set 
        
        entitycode = 1--".$this->invl($this->entitycode,true,true)."
        ,accountcode = ".$this->invl($this->accountcode,true,true)."
        ,subledgercode = ".$this->invl($this->subledgercode,true,true)."
        ,debitbalance = ".$this->invl($this->debitbalance,true,true)."
        ,creditbalance = ".$this->invl($this->creditbalance,true,true)."
        
        where 
        yearperiodcode=20192020
        and accountcode=".$this->invl($this->accountcode,true)."
        and subledgercode=".$this->invl($this->subledgercode,true)."
        ";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            return 1;
            exit;
        }
            else
        {
            return 0;
            exit;
        }
    }
    public function delete()
    {
        $this->dataoperationmode = operationmode::Delete;
        if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
        $query = "
        delete from accountopening
        where 
        yearperiodcode=20192020
        and accountcode=".$this->invl($this->accountcode,true)."
        and subledgercode=".$this->invl($this->subledgercode,true)."
        ";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
             return 1;
             exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function fetch()
    {
        $this->dataoperationmode = operationmode::Select;
        $query = "select 
        yearperiodcode
        ,entitycode
        ,accountcode
        ,subledgercode
        ,debitbalance
        ,creditbalance
        ,seasonyear
        from accountopening where 
        yearperiodcode=20192020
        and accountcode=".$this->invl($this->accountcode,true)."
        and subledgercode=".$this->invl($this->subledgercode,true)."
        ";
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
                $this->yearperiodcode = $row['YEARPERIODCODE'];
                $this->entitycode = $row['ENTITYCODE'];
                $this->accountcode = $row['ACCOUNTCODE'];
                $this->subledgercode = $row['SUBLEDGERCODE'];
                $this->debitbalance = $row['DEBITBALANCE'];
                $this->creditbalance = $row['CREDITBALANCE'];
                $this->seasonyear = $row['SEASONYEAR'];
                $this->accountcodetextcombo = $this->textcomboname($connection=$this->connection,$table='ACCOUNTHEAD',$datafield='ACCOUNTCODE',$datafieldvalue=$row['ACCOUNTCODE'],$engfield='ACCOUNTNAMEENG',$unicodefield='ACCOUNTNAMEUNI');
                $this->subledgercodetextcombo = $this->textcomboname($connection=$this->connection,$table='ACCOUNTSUBLEDGER',$datafield='SUBLEDGERCODE',$datafieldvalue=$row['SUBLEDGERCODE'],$engfield='SUBLEDGERNAMEENG',$unicodefield='SUBLEDGERNAMEUNI');
                $this->found=true;
                return true;
        }
        else
        {
        return false;
        }
    }
}
?>

