<?php
//This is generated by Swapp Software Application on 16/11/2018 08:48:59 PM for PHP
include_once("../swappbase/formbase.php");
include_once("../ip_model/accounthead_db_oracle.php");
include_once("../ip_model/voucheractiondetail_db_oracle.php");
class voucherdetail extends swappform
{
    Public $transactionnumber;
    Public $detailserialnumber;
    Public $accountcode;
    Public $subledgercode;
    Public $credit;
    Public $debit;
    Public $costcentrecode;
    Public $ledgerbalance;
    Public $subledgerbalance;
    public function __construct(&$connection)
    {
     		 parent::__construct($connection);
         $this->transactionnumber='';
         $this->detailserialnumber='';
         $this->accountcode='';
         $this->subledgercode='';
         $this->credit='';
         $this->debit='';
         $this->costcentrecode='';
	   }
    private function entryvalidation()
    {
    	$this->start_validation();
        $accounthead1 = new accounthead($this->connection);
        $this->checkrequired($this->accountcode,'Account code');
        if ($this->accountcode != '')
        {
            $accounthead1->accountcode = $this->accountcode;
            $accounthead1->fetch();
            if ($accounthead1->issubledgerallowed == 248805511)
            {
                $this->checkrequired($this->subledgercode,'Subledger code');
            }
            if ($accounthead1->isyearcodeallowed == 248805511)
            {
                if ($this->costcentrecode=='0')
                {
                    $this->invalidid =-123;
                    $this->invalidmessagetext='Crushing Season code is required';
                }
                //$this->checkrequired($this->costcentrecode,'Crushing Season code');
            }
            else
            {
                if ($this->costcentrecode!='0' and $this->costcentrecode!='')
                {
                    $this->invalidid =-123;
                    $this->invalidmessagetext='Crushing Season code is not required';
                }
            }
        }
        if ($this->credit=='' and $this->debit=='')
        {
            $this->checkrequired($this->credit,'Amount');
        }
        if ($this->credit>0 and $this->debit>0)
        {
            $this->invalidid =-123;
            $this->invalidmessagetext='Enter Only Debit or Credit Amount';
        }
        //$this->checkrequired($this->costcentrecode,'Cost center');
        //$this->costcentrecode =1;
        if ($this->costcentrecode==0)
        $this->costcentrecode='';
        $this->end_validation();
        return $this->invalidid;
	}
    private function datavalidation()
    {
        $this->start_validation();
    		$this->invalidid=0;
    		$this->invalidmessagetext='Validated';
    		$this->end_validation();
    		return $this->invalidid;
    }
    public function insert()
    {
        $this->dataoperationmode = operationmode::Insert;
	    if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
	    if ($this->detailserialnumber == '')
        {
            $query = "select nvl(max(detailserialnumber),0)+1 as detailserialnumber 
            from nst_nasaka_finance.voucherdetail
            where transactionnumber=".$this->transactionnumber;
            $result = oci_parse($this->connection, $query);
            $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
            $row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
            $this->detailserialnumber = $row["DETAILSERIALNUMBER"];
        }
        $query = "
            insert into nst_nasaka_finance.voucherdetail(
            transactionnumber
            ,detailserialnumber
            ,accountcode
            ,subledgercode
            ,credit
            ,debit
            ,costcentrecode
	        )
	        values (
            ".$this->invl($this->transactionnumber,true)."
            ,".$this->invl($this->detailserialnumber,true)."
            ,".$this->invl($this->accountcode,true,true)."
            ,".$this->invl($this->subledgercode,true,true)."
            ,".$this->invl($this->credit,true)."
            ,".$this->invl($this->debit,true)."
            ,".$this->invl($this->costcentrecode,true,true)."
            )";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            $this->costcentrecode = '';
            if ($this->voucherstatus>=1)
                {
                    $voucheractiondetail1 = new voucheractiondetail($this->connection);
                    $voucheractiondetail1->transactionnumber = $this->transactionnumber;
                    $voucheractiondetail1->usercode = $_SESSION['usersid'];
                    $voucheractiondetail1->actioncode = 2;
                    $ret = $voucheractiondetail1->insert();
                    if ($ret == 1)
                    {
                        return 1;
                        exit;
                    }
                    else
                    {
                        return 0;
                        exit;
                    }
                }
            else
            {
                return 1;
                exit;
            }
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function display()
	  {
		    $this->dataoperationmode = operationmode::Select;
		    $cond='';
		    if ($this->accountcode!='' and $this->accountcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.accountcode = ".$this->accountcode;
			       }
			       else
			       {
				         $cond=$cond." and t.accountcode = ".$this->accountcode;
			       }
		    }
		    if ($this->subledgercode!='' and $this->subledgercode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.subledgercode = ".$this->subledgercode;
			       }
			       else
			       {
				         $cond=$cond." and t.subledgercode = ".$this->subledgercode;
			       }
		    }
		    if ($this->credit!='' and $this->credit!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.credit = ".$this->credit;
			       }
			       else
			       {
				         $cond=$cond." and t.credit = ".$this->credit;
			       }
		    }
		    if ($this->debit!='' and $this->debit!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.debit = ".$this->debit;
			       }
			       else
			       {
				         $cond=$cond." and t.debit = ".$this->debit;
			       }
		    }
		    if ($this->costcentrecode!='' and $this->costcentrecode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.costcentrecode = ".$this->costcentrecode;
			       }
			       else
			       {
				         $cond=$cond." and t.costcentrecode = ".$this->costcentrecode;
			       }
		    }
        if ($cond!='')
		    {
		        $query = "select t.* from nst_nasaka_finance.voucherdetail t where ".$cond." order by transactionnumber,detailserialnumber";
			      $result = oci_parse($this->connection, $query);
            $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
			      return $result;
		     }
		     else
		     {
		         $query = "select t.* from nst_nasaka_finance.voucherdetail t order by transactionnumber,detailserialnumber";
			       $result = oci_parse($this->connection, $query);
             $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
			       return $result;
		     }
	  }
    public function update()
    {
        $this->dataoperationmode = operationmode::Update;
        if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
        $query = "
        update nst_nasaka_finance.voucherdetail set 
        accountcode = ".$this->invl($this->accountcode,true)."
        ,subledgercode = ".$this->invl($this->subledgercode,true)."
        ,credit = ".$this->invl($this->credit,true)."
        ,debit = ".$this->invl($this->debit,true)."
        ,costcentrecode = ".$this->invl($this->costcentrecode,true)."
        where 
        transactionnumber = ".$this->invl($this->transactionnumber,true)."
        and detailserialnumber = ".$this->invl($this->detailserialnumber,true)."
        ";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            $this->costcentrecode = '';
            if ($this->voucherstatus>=1)
                {
                    $voucheractiondetail1 = new voucheractiondetail($this->connection);
                    $voucheractiondetail1->transactionnumber = $this->transactionnumber;
                    $voucheractiondetail1->usercode = $_SESSION['usersid'];
                    $voucheractiondetail1->actioncode = 2;
                    $ret = $voucheractiondetail1->insert();
                    if ($ret == 1)
                    {
                        return 1;
                        exit;
                    }
                    else
                    {
                        return 0;
                        exit;
                    }
                }
            else
            {
                return 1;
                exit;
            }
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function delete()
    {
        $this->dataoperationmode = operationmode::Update;
        /* if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        } */
        $query = "
        delete from nst_nasaka_finance.voucherdetail
        where 
        transactionnumber = ".$this->invl($this->transactionnumber,true)."
        and detailserialnumber = ".$this->invl($this->detailserialnumber,true)."
        ";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            $this->costcentrecode = '';
            if ($this->voucherstatus>=1)
                {
                    $voucheractiondetail1 = new voucheractiondetail($this->connection);
                    $voucheractiondetail1->transactionnumber = $this->transactionnumber;
                    $voucheractiondetail1->usercode = $_SESSION['usersid'];
                    $voucheractiondetail1->actioncode = 2;
                    $ret = $voucheractiondetail1->insert();
                    if ($ret == 1)
                    {
                        return 1;
                        exit;
                    }
                    else
                    {
                        return 0;
                        exit;
                    }
                }
            else
            {
                return 1;
                exit;
            }
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function deletevoucherdetails()
    {
        $this->dataoperationmode = operationmode::Update;
        /* if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        } */
        $query = "
        delete from nst_nasaka_finance.voucherdetail
        where 
        transactionnumber = ".$this->invl($this->transactionnumber,true);
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            if ($this->voucherstatus>=1)
                {
                    $voucheractiondetail1 = new voucheractiondetail($this->connection);
                    $voucheractiondetail1->transactionnumber = $this->transactionnumber;
                    $voucheractiondetail1->usercode = $_SESSION['usersid'];
                    $voucheractiondetail1->actioncode = 2;
                    $ret = $voucheractiondetail1->insert();
                    if ($ret == 1)
                    {
                        return 1;
                        exit;
                    }
                    else
                    {
                        return 0;
                        exit;
                    }
                }
            else
            {
                return 1;
                exit;
            }
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function fetch()
    {
        $this->dataoperationmode = operationmode::Select;
        $query = "select 
        transactionnumber
        ,detailserialnumber
        ,accountcode
        ,subledgercode
        ,credit
        ,debit
        ,costcentrecode
        ,accountclosingbalance(".$_SESSION['yearperiodcode'].",accountcode) as ledgerbalance
        ,case when subledgercode is not null then
        subaccountclosingbalance(".$_SESSION['yearperiodcode'].",accountcode,subledgercode)
        else
        0 end as subledgerbalance
        from nst_nasaka_finance.voucherdetail where 
        transactionnumber = ".$this->invl($this->transactionnumber,true)."
         and detailserialnumber = ".$this->invl($this->detailserialnumber,true)."
        ";
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
                $this->transactionnumber = $row['TRANSACTIONNUMBER'];
                $this->detailserialnumber = $row['DETAILSERIALNUMBER'];
                $this->accountcode = $row['ACCOUNTCODE'];
                $this->subledgercode = $row['SUBLEDGERCODE'];
                $this->credit = $row['CREDIT'];
                $this->debit = $row['DEBIT'];
                $this->costcentrecode = $row['COSTCENTRECODE'];
                if ($row['LEDGERBALANCE']>=0)
                {
                    $this->ledgerbalance=round($row['LEDGERBALANCE'],2).' Dr';
                }
                elseif ($row['LEDGERBALANCE']<0)
                {
                    $this->ledgerbalance=abs(round($row['LEDGERBALANCE'],2)).' Cr';
                }
                if ($row['SUBLEDGERBALANCE']>0)
                {
                    $this->subledgerbalance=round($row['SUBLEDGERBALANCE'],2).' Dr';
                }
                elseif ($row['SUBLEDGERBALANCE']<0)
                {
                    $this->subledgerbalance=abs(round($row['SUBLEDGERBALANCE'],2)).' Cr';
                }
                else
                {
                    $this->subledgerbalance=' ';
                }
                $this->found=true;
                return true;
        }
        else
        {
        return false;
        }
    }
    public function fetchbyaccountcode()
    {
        $this->dataoperationmode = operationmode::Select;
        $query = "select 
        transactionnumber
        ,detailserialnumber
        ,accountcode
        ,subledgercode
        ,credit
        ,debit
        ,costcentrecode
        ,accountclosingbalance(".$_SESSION['yearperiodcode'].",accountcode) as ledgerbalance
        ,case when subledgercode is not null then
        subaccountclosingbalance(".$_SESSION['yearperiodcode'].",accountcode,subledgercode)
        else
        0 end as subledgerbalance
        from nst_nasaka_finance.voucherdetail where 
        transactionnumber = ".$this->invl($this->transactionnumber,true)."
         and accountcode = ".$this->invl($this->accountcode,true)."
        ";
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
                $this->transactionnumber = $row['TRANSACTIONNUMBER'];
                $this->detailserialnumber = $row['DETAILSERIALNUMBER'];
                $this->accountcode = $row['ACCOUNTCODE'];
                $this->subledgercode = $row['SUBLEDGERCODE'];
                $this->credit = $row['CREDIT'];
                $this->debit = $row['DEBIT'];
                $this->costcentrecode = $row['COSTCENTRECODE'];
                if ($row['LEDGERBALANCE']>=0)
                {
                    $this->ledgerbalance=round($row['LEDGERBALANCE'],2).' Dr';
                }
                elseif ($row['LEDGERBALANCE']<0)
                {
                    $this->ledgerbalance=abs(round($row['LEDGERBALANCE'],2)).' Cr';
                }
                if ($row['SUBLEDGERBALANCE']>0)
                {
                    $this->subledgerbalance=round($row['SUBLEDGERBALANCE'],2).' Dr';
                }
                elseif ($row['SUBLEDGERBALANCE']<0)
                {
                    $this->subledgerbalance=abs(round($row['SUBLEDGERBALANCE'],2)).' Cr';
                }
                else
                {
                    $this->subledgerbalance=' ';
                }
                $this->found=true;
                return true;
        }
        else
        {
        return false;
        }
    }
    public function deleteall()
    {
        $this->dataoperationmode = operationmode::Delete;
        if ($this->transactionnumber <= 0)
        {
            return 0;
            exit;
        }
        $query = "
        delete from nst_nasaka_finance.voucherdetail
        where 
        transactionnumber = ".$this->invl($this->transactionnumber,true);
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            return 1;
            exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function creditaccountheadfetch()
    {
        $this->dataoperationmode = operationmode::Select;
        $query = "select * from (select h.accountcode,h.accountnameeng
        ,h.accountnameuni,h.issubledgerallowed
        ,v.credit credit,v.detailserialnumber detailserialnumber
        from nst_nasaka_finance.voucherdetail v,nst_nasaka_finance.accounthead h
        where v.accountcode=h.accountcode
        and transactionnumber = ".$this->invl($this->transactionnumber,true).
        " and nvl(v.credit,0)>0 
        and issubledgerallowed=248805611
        union all
        select h.accountcode,h.accountnameeng
        ,h.accountnameuni,h.issubledgerallowed
        ,sum(v.credit) credit,0 detailserialnumber
        from nst_nasaka_finance.voucherdetail v,nst_nasaka_finance.accounthead h
        where v.accountcode=h.accountcode
        and transactionnumber = ".$this->invl($this->transactionnumber,true).
        " and nvl(v.credit,0)>0 
        and issubledgerallowed=248805511
        group by h.accountcode,h.accountnameeng
        ,h.accountnameuni,h.issubledgerallowed)
        order by detailserialnumber";
        $result = oci_parse($this->connection, $query);
        return $result;
    }
    public function creditsubledgerfetch($accountcode)
    {
        $this->dataoperationmode = operationmode::Select;
        $query = "select 
        v.accountcode
        ,s.subledgercode
        ,s.subledgernameeng
        ,s.subledgernameuni
        ,v.credit
        ,v.detailserialnumber
        ,s.referencecode
        ,case when nvl(v.costcentrecode,1)<>1 then v.costcentrecode end costcentrecode
        from nst_nasaka_finance.voucherdetail v,nst_nasaka_finance.accounthead h,nst_nasaka_finance.accountsubledger s
        where v.accountcode=h.accountcode
        and h.accountcode=s.accountcode
        and v.subledgercode=s.subledgercode(+)
        and v.accountcode=".$accountcode." 
        and transactionnumber = ".$this->invl($this->transactionnumber,true).
        " and nvl(v.credit,0)>0 order by detailserialnumber";
        $result = oci_parse($this->connection, $query);
        return $result;
    }

    public function debitaccountheadfetch()
    {
        $this->dataoperationmode = operationmode::Select;
        $query = "select * from (select h.accountcode,h.accountnameeng
        ,h.accountnameuni,h.issubledgerallowed
        ,v.debit debit,v.detailserialnumber detailserialnumber
        from nst_nasaka_finance.voucherdetail v,nst_nasaka_finance.accounthead h
        where v.accountcode=h.accountcode
        and transactionnumber = ".$this->invl($this->transactionnumber,true).
        " and nvl(v.debit,0)>0 
        and issubledgerallowed=248805611
        union all
        select h.accountcode,h.accountnameeng
        ,h.accountnameuni,h.issubledgerallowed
        ,sum(v.debit) debit,0 detailserialnumber
        from nst_nasaka_finance.voucherdetail v,nst_nasaka_finance.accounthead h
        where v.accountcode=h.accountcode
        and transactionnumber = ".$this->invl($this->transactionnumber,true).
        " and nvl(v.debit,0)>0 
        and issubledgerallowed=248805511
        group by h.accountcode,h.accountnameeng
        ,h.accountnameuni,h.issubledgerallowed)
        order by detailserialnumber";
        $result = oci_parse($this->connection, $query);
        return $result;
    }
    public function debitsubledgerfetch($accountcode)
    {
        $this->dataoperationmode = operationmode::Select;
        $query = "select 
        v.accountcode
        ,s.subledgercode
        ,s.subledgernameeng
        ,s.subledgernameuni
        ,v.debit
        ,v.detailserialnumber
        ,s.referencecode
        ,case when nvl(v.costcentrecode,1)<>1 then v.costcentrecode end costcentrecode
        from nst_nasaka_finance.voucherdetail v,nst_nasaka_finance.accounthead h,nst_nasaka_finance.accountsubledger s
        where v.accountcode=h.accountcode
        and h.accountcode=s.accountcode
        and v.subledgercode=s.subledgercode(+)
        and v.accountcode=".$accountcode." 
        and s.subledgercode is not null
        and transactionnumber = ".$this->invl($this->transactionnumber,true).
        " and nvl(v.debit,0)>0 order by detailserialnumber";
        $result = oci_parse($this->connection, $query);
        return $result;
    }
    public function updateheader()
    {
        $query = "update nst_nasaka_finance.voucherheader v
        set totalcredit=(select nvl(sum(credit),0) 
                         from nst_nasaka_finance.voucherdetail d
                         where d.transactionnumber=".$this->transactionnumber."),
            totaldebit=(select nvl(sum(debit),0) 
                         from nst_nasaka_finance.voucherdetail d
                         where d.transactionnumber=".$this->transactionnumber.")
        where v.transactionnumber=".$this->transactionnumber; 
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
             return 1;
             exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function isbankaccountcode($accountcode)
    {
        $query = "select 1 as yn 
        from nst_nasaka_finance.accounthead a,nst_nasaka_finance.accountcontroltable t
        where ((a.groupcode=t.bankgroupcode
        and a.subgroupcode=t.banksubgroupcode) 
        or (a.groupcode=t.bankgroupcode1)
        or (a.groupcode=t.bankgroupcode2))
        and a.accountcode=".$accountcode; 
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            return $row['YN'];
        }
        else
        {
            return 0;
        }
    }
    public function cashaccountcode()
    {
        $query = "select cashaccountcode
        from nst_nasaka_finance.accountcontroltable"; 
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            return $row['CASHACCOUNTCODE'];
        }
        else
        {
            return 0;
        }
    }
    public function cashdetailserialnumber()
    {
        $query = "select detailserialnumber
        from nst_nasaka_finance.voucherdetail h
        where h.accountcode=".$this->cashaccountcode()." and h.transactionnumber=".$this->transactionnumber; 
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            return $row['DETAILSERIALNUMBER'];
        }
        else
        {
            return 0;
        }
    }
    public function updatecashdetail()
    {
        $query = "select h.vouchersubtypecode,
        nvl(max(d.detailserialnumber),0) as detailserialnumber
        from nst_nasaka_finance.voucherheader h,nst_nasaka_finance.voucherdetail d
        where 
        h.transactionnumber=d.transactionnumber
        and h.vouchersubtypecode in (1,4,7)
        and d.transactionnumber=".$this->transactionnumber."
        group by h.vouchersubtypecode";
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            $cashdetailserialnumber = $this->cashdetailserialnumber();
            if ($cashdetailserialnumber==0)
            {
                $this->accountcode = $this->cashaccountcode();
                if ($row['VOUCHERSUBTYPECODE']==1)
                {
                    $this->debit = $this->credit;
                    $this->credit = null;
                    $this->subledgercode = null;
                }
                elseif ($row['VOUCHERSUBTYPECODE']==4 or $row['VOUCHERSUBTYPECODE']==7)
                {
                    $this->credit = $this->debit;
                    $this->debit = null;
                    $this->subledgercode = null;
                }
                $this->detailserialnumber = 2;
                if ($this->insert() == 1)
                {
                    return 1;
                    exit;
                }
                else
                {
                    return 0;
                    exit;
                }
            }
            else
            {
                if ($row['VOUCHERSUBTYPECODE']==1)
                {
                    $query1 = "select nvl(sum(d.credit),0) as crdr
                    from nst_nasaka_finance.voucherdetail d
                    where d.transactionnumber=".$this->transactionnumber."
                    and d.accountcode not 
                    in (select cashaccountcode
                    from accountcontroltable a
                    )"; 
                }
                elseif ($row['VOUCHERSUBTYPECODE']==4 or $row['VOUCHERSUBTYPECODE']==7)
                {
                    $query1 = "select nvl(sum(d.debit),0) as crdr
                    from nst_nasaka_finance.voucherdetail d
                    where d.transactionnumber=".$this->transactionnumber."
                    and d.accountcode not in 
                    (select cashaccountcode
                    from nst_nasaka_finance.accountcontroltable a)"; 
                }
                
                $result1 = oci_parse($this->connection, $query1);
                $r1 = oci_execute($result1,OCI_NO_AUTO_COMMIT);
                if ($row1 = oci_fetch_array($result1,OCI_ASSOC+OCI_RETURN_NULLS))
                {
                    if ($row['VOUCHERSUBTYPECODE']==1)
                    {
                        $this->debit = $row1['CRDR'];
                        $this->credit = null;    
                    }
                    elseif ($row['VOUCHERSUBTYPECODE']==4 or $row['VOUCHERSUBTYPECODE']==7)
                    {
                        $this->credit = $row1['CRDR'];
                        $this->debit = null;    
                    }
                    $this->subledgercode = null;
                    $this->accountcode = $this->cashaccountcode();
                    $this->detailserialnumber = $cashdetailserialnumber;
                    if ($this->update() == 1)
                    {
                        return 1;
                        exit;
                    }
                    else
                    {
                        return 0;
                        exit;
                    }
                }
            }
        }
        else
        {
            return -1;
            exit;
        }
    }
}
?>

