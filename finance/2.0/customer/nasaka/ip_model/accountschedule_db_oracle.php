<?php
//This is generated by Swapp Software Application on 10/11/2018 06:06:11 PM for PHP
include("../swappbase/formbase.php");
class accountschedule extends swappform
{
    Public $schedulecode;
    Public $schedulenameeng;
    Public $schedulenameuni;
    Public $grouptypecode;
    Public $schedulenumber;
    Public $groupcode;
    Public $subgroupcode;
    Public $subsubgroupcode;
    public function __construct(&$connection)
    {
     		 parent::__construct($connection);
         $this->schedulecode='';
         $this->schedulenameeng='';
         $this->schedulenameuni='';
         $this->grouptypecode='';
         $this->schedulenumber='';
         $this->groupcode='';
         $this->subgroupcode='';
         $this->subsubgroupcode='';
	   }
    private function entryvalidation()
    {
    		$this->start_validation();
        $this->checkrequired($this->schedulenameeng,'Schedule name (English)');
        $this->checkrequired($this->schedulenameuni,'Schedule code(Unicode)');
        $this->checkrequired($this->grouptypecode,'Schedule type code');
        $this->checkrequired($this->schedulenumber,'Schedule Number');
        if ($this->groupcode>0)
        {
            if (($this->subgroupcode)==-1)
            {
                $this->subgroupcode ='';
            }
            /*if ($this->issubgroupexists()==1 and ($this->subgroupcode=='' or $this->subgroupcode=='0'))
            {
                $this->invalidid=-123;
    		    $this->invalidmessagetext='Subgroup is required';
                return $this->invalidid;
            } */
            
            if (($this->subgroupcode)>0)
            {
                if ($this->issubgroupvalid()==0)
                {
                    $this->invalidid=-123;
                    $this->invalidmessagetext='Sub group is invalid';
                    return $this->invalidid;
                }
                if (($this->subsubgroupcode)==-1)
                {
                    $this->subsubgroupcode = '';
                }
                /*elseif ($this->issubsubgroupexists()==1 and ($this->subsubgroupcode=='' or $this->subsubgroupcode=='0'))
                {
                    $this->invalidid=-123;
                    $this->invalidmessagetext='Sub Subgroup is required';
                    return $this->invalidid;
                } */
                if (($this->subsubgroupcode)>0)
                {
                    if ($this->issubsubgroupvalid()==0)
                    {
                        $this->invalidid=-123;
                        $this->invalidmessagetext='Sub Subgroup is invalid';
                        return $this->invalidid;
                    }
                }
            }
        }
        $this->end_validation();
        return $this->invalidid;
	  }
    private function datavalidation()
    {
        $this->start_validation();
    		$this->invalidid=0;
    		$this->invalidmessagetext='Validated';
    		$this->end_validation();
            return $this->invalidid;
    }
    public function insert()
    {
        $this->dataoperationmode = operationmode::Insert;
	    if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
	    if ($this->schedulecode == '')
        {
            $query = "select nvl(max(schedulecode),0)+1 as schedulecode from accountschedule";
            $result = oci_parse($this->connection, $query);
            $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
            $row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
            $this->schedulecode = $row["SCHEDULECODE"];
        }
        $query = "
            insert into accountschedule(
            schedulecode
            ,schedulenameeng
            ,schedulenameuni
            ,grouptypecode
            ,schedulenumber
            ,groupcode
            ,subgroupcode
            ,subsubgroupcode
	        )
	        values (
            ".$this->invl($this->schedulecode,true)."
            ,".$this->invl($this->schedulenameeng,false)."
            ,".$this->invl($this->schedulenameuni,false)."
            ,".$this->invl($this->grouptypecode,true,true)."
            ,".$this->invl($this->schedulenumber,false)."
            ,".$this->invl($this->groupcode,true,true)."
            ,".$this->invl($this->subgroupcode,true,true)."
            ,".$this->invl($this->subsubgroupcode,true,true)."
            )";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            return 1;
            exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function display()
	  {
		    $this->dataoperationmode = operationmode::Select;
		    $cond='';
		    if ($this->schedulenameeng!='')
		    {
			      if ($cond=='')
			      {
				        $cond="schedulenameeng like '%".$this->schedulenameeng."%'";
			       }
			       else
			       {
				         $cond=$cond." and schedulenameeng like '%".$this->schedulenameeng."%'";
			       }
		    }
		    if ($this->schedulenameuni!='')
		    {
			      if ($cond=='')
			      {
				        $cond="schedulenameuni like '%".$this->schedulenameuni."%'";
			       }
			       else
			       {
				         $cond=$cond." and schedulenameuni like '%".$this->schedulenameuni."%'";
			       }
		    }
		    if ($this->grouptypecode!='' and $this->grouptypecode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="grouptypecode = ".$this->grouptypecode;
			       }
			       else
			       {
				         $cond=$cond." and grouptypecode = ".$this->grouptypecode;
			       }
            }
            if ($this->schedulenumber!='')
		    {
			      if ($cond=='')
			      {
				        $cond="schedulenumber like '%".$this->schedulenumber."%'";
			       }
			       else
			       {
				         $cond=$cond." and schedulenumber like '%".$this->schedulenumber."%'";
			       }
            }
            if ($this->groupcode!='' and $this->groupcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="groupcode = ".$this->groupcode;
			       }
			       else
			       {
				         $cond=$cond." and groupcode = ".$this->groupcode;
			       }
		    }
		    if ($this->subgroupcode!='' and $this->subgroupcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="subgroupcode = ".$this->subgroupcode;
			       }
			       else
			       {
				         $cond=$cond." and subgroupcode = ".$this->subgroupcode;
			       }
		    }
		    if ($this->subsubgroupcode!='' and $this->subsubgroupcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="subsubgroupcode = ".$this->subsubgroupcode;
			       }
			       else
			       {
				         $cond=$cond." and subsubgroupcode = ".$this->subsubgroupcode;
			       }
		    }

        if ($cond!='')
		    {
		        $query = "select * from accountschedule where ".$cond." order by schedulecode";
			      $result = oci_parse($this->connection, $query);
            $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
			      return $result;
		     }
		     else
		     {
		         $query = "select * from accountschedule order by schedulecode";
			       $result = oci_parse($this->connection, $query);
             $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
			       return $result;
		     }
	  }
    public function update()
    {
        $this->dataoperationmode = operationmode::Update;
        if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
        $query = "
        update accountschedule set 
        schedulenameeng =".$this->invl($this->schedulenameeng,false)."
        ,schedulenameuni =".$this->invl($this->schedulenameuni,false)."
        ,grouptypecode = ".$this->invl($this->grouptypecode,true)."
        ,schedulenumber = ".$this->invl($this->schedulenumber,false)."
        ,groupcode = ".$this->invl($this->groupcode,true)."
        ,subgroupcode = ".$this->invl($this->subgroupcode,true,true)."
        ,subsubgroupcode = ".$this->invl($this->subsubgroupcode,true,true)."
        where 
        schedulecode = ".$this->invl($this->schedulecode,true)."
        ";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            return 1;
            exit;
        }
            else
        {
            return 0;
            exit;
        }
    }
    public function delete()
    {
        $this->dataoperationmode = operationmode::Update;
        if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
        $query = "
        delete from accountschedule
        where 
        schedulecode = ".$this->invl($this->schedulecode,true)."
        ";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
             return 1;
             exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function fetch()
    {
        $this->dataoperationmode = operationmode::Select;
        $query = "select 
        schedulecode
        ,schedulenameeng
        ,schedulenameuni
        ,grouptypecode
        ,schedulenumber
        ,groupcode
        ,subgroupcode
        ,subsubgroupcode
        from ACCOUNTSCHEDULE where 
        schedulecode = ".$this->invl($this->schedulecode,true)."
        ";
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
                $this->schedulecode = $row['SCHEDULECODE'];
                $this->schedulenameeng = $row['SCHEDULENAMEENG'];
                $this->schedulenameuni = $row['SCHEDULENAMEUNI'];
                $this->grouptypecode = $row['GROUPTYPECODE'];
                $this->schedulenumber = $row['SCHEDULENUMBER'];
                $this->groupcode = $row['GROUPCODE'];
                $this->subgroupcode = $row['SUBGROUPCODE'];
                $this->subsubgroupcode = $row['SUBSUBGROUPCODE'];
                $this->found=true;
                return true;
        }
        else
        {
        return false;
        }
    }
    function issubgroupexists()
    {
        $query = "select count(*) as cnt 
        from accountsubgroup s 
        where s.groupcode = ".$this->invl($this->groupcode,true);
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            if ($row['CNT']>0)
            {
                return 1;
            }
            else
            {
                return 0;
            }
        }
        else
        {
            return 0;
        }
    }

    function issubsubgroupexists()
    {
        $query = "select count(*) as cnt 
        from accountsubsubgroup s 
        where s.groupcode = ".$this->invl($this->groupcode,true).
        " and s.subgroupcode=".$this->invl($this->subgroupcode,true);
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            if ($row['CNT']>0)
            {
                return 1;
            }
            else
            {
                return 0;
            }
        }
        else
        {
            return 0;
        }
    }
    function issubgroupvalid()
    {
        $query = "select count(*) as cnt 
        from accountsubgroup s 
        where s.groupcode = ".$this->invl($this->groupcode,true).
        " and s.subgroupcode=".$this->invl($this->subgroupcode,true);
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            if ($row['CNT']>0)
            {
                return 1;
            }
            else
            {
                return 0;
            }
        }
        else
        {
            return 0;
        }
    }
    function issubsubgroupvalid()
    {
        $query = "select count(*) as cnt 
        from accountsubsubgroup s 
        where s.groupcode = ".$this->invl($this->groupcode,true).
        " and s.subgroupcode=".$this->invl($this->subgroupcode,true).
        " and s.subsubgroupcode=".$this->invl($this->subsubgroupcode,true);
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            if ($row['CNT']>0)
            {
                return 1;
            }
            else
            {
                return 0;
            }
        }
        else
        {
            return 0;
        }
    }
}
?>

