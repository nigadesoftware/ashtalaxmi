<?php
//This is generated by Swapp Software Application on 11/11/2018 10:40:09 AM for PHP
include_once("../swappbase/formbase.php");
include_once("../info/marathi2english.php");
class accounthead extends swappform
{ 
    Public $accountcode;
    Public $accountnameeng;
    Public $accountnameuni;
    Public $groupcode;
    Public $subgroupcode;
    Public $subsubgroupcode;
    Public $schedulecode;
    Public $subschedulecode;
    Public $subsubschedulecode;
    Public $subsubsubschedulecode;
    Public $issubledgerallowed;
    public $refcode;
    public $isyearcodeallowed;
    public $isdaybookdetaildisplay;
    public $isvoucherdetaildisplay;
    public function __construct(&$connection)
    {
     		 parent::__construct($connection);
         $this->accountcode='';
         $this->accountnameeng='';
         $this->accountnameuni='';
         $this->groupcode='';
         $this->subgroupcode='';
         $this->subsubgroupcode='';
         $this->schedulecode='';
         $this->subschedulecode='';
         $this->subsubschedulecode='';
         $this->subsubsubschedulecode='';
         $this->issubledgerallowed='';
         $this->refcode='';
	   }
    private function entryvalidation()
    {
    	$this->start_validation();
        $this->checkrequired($this->accountnameeng,'Account name(English)');
        $this->englishtextdigitonly($this->accountnameeng,'Account name(English)');
        $this->checkrequired($this->accountnameuni,'Account name (Unicode)');
        //$this->unicodedevanagaritextdigitonly($this->accountnameuni,'Account name (Unicode)');
        $this->checkrequired($this->groupcode,'Group code');
        if ($this->groupcode>0)
        {
            if (($this->subgroupcode)==-1)
            {
                $this->invalidid=-123;
    		    $this->invalidmessagetext='Subgroup is required';
                return $this->invalidid;
            }
            elseif ($this->issubgroupexists()==1 and ($this->subgroupcode=='' or $this->subgroupcode=='0'))
            {
                $this->invalidid=-123;
    		    $this->invalidmessagetext='Subgroup is required';
                return $this->invalidid;
            }
            
            if (($this->subgroupcode)>0)
            {
                if ($this->issubgroupvalid()==0)
                {
                    $this->invalidid=-123;
                    $this->invalidmessagetext='Sub group is invalid';
                    return $this->invalidid;
                }
                if (($this->subsubgroupcode)==-1)
                {
                    $this->invalidid=-123;
                    $this->invalidmessagetext='Subsubgroup is required';
                    return $this->invalidid;
                }
                elseif ($this->issubsubgroupexists()==1 and ($this->subsubgroupcode=='' or $this->subsubgroupcode=='0'))
                {
                    $this->invalidid=-123;
                    $this->invalidmessagetext='Sub Subgroup is required';
                    return $this->invalidid;
                }
                if (($this->subsubgroupcode)>0)
                {
                    if ($this->issubsubgroupvalid()==0)
                    {
                        $this->invalidid=-123;
                        $this->invalidmessagetext='Sub Subgroup is invalid';
                        return $this->invalidid;
                    }
                }
            }
        }
        if ($this->schedulecode>0)
        {
            if (($this->subschedulecode)==-1)
            {
                $this->invalidid=-123;
    		    $this->invalidmessagetext='Subschedule is required';
                return $this->invalidid;
            }
            elseif ($this->issubscheduleexists()==1 and ($this->subschedulecode=='' or $this->subschedulecode=='0'))
            {
                $this->invalidid=-123;
    		    $this->invalidmessagetext='Subschedulecode is required';
                return $this->invalidid;
            }
            if (($this->subschedulecode)>0)
            {
                if ($this->issubschedulevalid()==0)
                {
                    $this->invalidid=-123;
                    $this->invalidmessagetext='Sub schedule is invalid';
                    return $this->invalidid;
                }
                if (($this->subsubschedulecode)==-1)
                {
                    $this->invalidid=-123;
                    $this->invalidmessagetext='Sub Subschedule is required';
                    return $this->invalidid;
                }
                if (($this->subsubschedulecode)>0)
                {
                    if ($this->issubsubschedulevalid()==0)
                    {
                        $this->invalidid=-123;
                        $this->invalidmessagetext='Sub Subschedule is invalid';
                        return $this->invalidid;
                    }
                    if (($this->subsubsubschedulecode)==-1)
                    {
                        $this->invalidid=-123;
                        $this->invalidmessagetext='Sub Sub subschedule is required';
                        return $this->invalidid;
                    }
                    if (($this->subsubsubschedulecode)>0)
                    {
                        if ($this->issubsubsubschedulevalid()==0)
                        {
                            $this->invalidid=-123;
                            $this->invalidmessagetext='Sub Sub Subschedule is invalid';
                            return $this->invalidid;
                        }
                    }
                }
            }
        }
        else if ($this->isscheduleexists()==1)
        {
            $this->invalidid=-123;
            $this->invalidmessagetext='Schedule is required';
            return $this->invalidid;
        }
        $this->checkrequired($this->issubledgerallowed,'Subledger Allowed?');
        $this->checkrequired($this->isyearcodeallowed,'Crushing Season Allowed?');
        $this->end_validation();
        return $this->invalidid;
	  }
    private function datavalidation()
    {
        $this->start_validation();
    		$this->invalidid=0;
    		$this->invalidmessagetext='Validated';
    		$this->end_validation();
    		return $this->invalidid;
    }
    public function nextaccountcode()
    {
        //$query = "select nvl(max(accountcode),0)+1 as accountcode from accounthead";
        if ($this->schedulecode =='' or $this->schedulecode=='0')
        {
            $query ="select shno,(select trim(to_char(count(*)+1,'000')) 
            from accounthead h,accountgroup j
            where h.groupcode=j.groupcode 
            and j.legalentitycode=k.legalentitycode 
            and j.grouptypecode=k.grouptypecode 
            and h.accountcode is not null
            and h.schedulecode is null) as cnt from
            (select g.groupcode,g.legalentitycode,g.grouptypecode,g.divisioncode||g.grouptypecode||'00' as shno
                        from accountgroup g,(select legalentitycode,grouptypecode
                        from (
                        select g.legalentitycode,g.grouptypecode
                        from accountgroup g
                        where g.groupcode=".$this->groupcode."
                        group by g.legalentitycode,g.grouptypecode))t
                        where g.legalentitycode=t.legalentitycode
                        and g.grouptypecode=t.grouptypecode
                        and g.groupcode=".$this->groupcode." 
                        group by g.groupcode,g.legalentitycode,g.grouptypecode,g.divisioncode)k";
                        $a=0;
        }
        else
        {
            $query ="select shno,(select trim(to_char(count(*)+1,'000')) from accounthead h
            where h.schedulecode=k.schedulecode and h.accountcode is not null) as cnt from
            (
            select s.schedulecode,g.divisioncode||g.grouptypecode||trim(to_char(s.schedulenumber,'00')) as shno
            from accountschedule s,accountgroup g
            where s.groupcode=g.groupcode and s.schedulecode=".$this->schedulecode."
            group by s.schedulecode,g.divisioncode||g.grouptypecode||trim(to_char(s.schedulenumber,'00')))k";
        }
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        $row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
        return $row['SHNO'].$row['CNT'];
    }
    public function iscodeexist($nextcode)
    {
        $query ="select nvl(count(*),0) as cnt 
            from accounthead h
            where h.accountcode=".$nextcode;
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            if ($row['CNT']==0)
            {
                return 0;
            }
            else
            {
                return 1;
            }
        }
        else
        {
            return 0;
        }
        
    }
    public function insert()
    {
        $this->dataoperationmode = operationmode::Insert;
	    if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
	    if ($this->accountcode == '')
        {
            $nxtcode = $this->nextaccountcode();
            while ($this->iscodeexist($nxtcode)!=0)
            {
                $nxtcode++;
            }
            $this->accountcode = $nxtcode;
        }
        $query = "
            insert into accounthead(
            accountcode
            ,accountnameeng
            ,accountnameuni
            ,groupcode
            ,subgroupcode
            ,subsubgroupcode
            ,schedulecode
            ,subschedulecode
            ,subsubschedulecode
            ,subsubsubschedulecode
            ,issubledgerallowed
            ,refcode
            ,isyearcodeallowed
            ,isdaybookdetaildisplay
            ,isvoucherdetaildisplay
	        )
	        values (
            ".$this->invl($this->accountcode,true)."
            ,".$this->invl($this->accountnameeng,false)."
            ,".$this->invl($this->accountnameuni,false)."
            ,".$this->invl($this->groupcode,true,true)."
            ,".$this->invl($this->subgroupcode,true,true)."
            ,".$this->invl($this->subsubgroupcode,true,true)."
            ,".$this->invl($this->schedulecode,true,true)."
            ,".$this->invl($this->subschedulecode,true,true)."
            ,".$this->invl($this->subsubschedulecode,true,true)."
            ,".$this->invl($this->subsubsubschedulecode,true,true)."
            ,".$this->invl($this->issubledgerallowed,true,true)."
            ,".$this->invl($this->refcode,false)."
            ,".$this->invl($this->isyearcodeallowed,true)."
            ,".$this->invl($this->isdaybookdetaildisplay,true)."
            ,".$this->invl($this->isvoucherdetaildisplay,true)."
            )";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            return 1;
            exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function display()
	  {
		    $this->dataoperationmode = operationmode::Select;
		    $cond='';
		    if ($this->accountcode!='' and $this->accountcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="to_char(accountcode) like '".$this->accountcode."%'";
			       }
			       else
			       {
				         $cond=$cond." and to_char(accountcode) like '".$this->accountcode."%'";
			       }
		    }
		    if ($this->accountnameeng!='')
		    {
			      if ($cond=='')
			      {
				        $cond="upper(accountnameeng) like '%".strtoupper($this->accountnameeng)."%'";
			       }
			       else
			       {
				         $cond=$cond." and upper(accountnameeng) like '%".strtoupper($this->accountnameeng)."%'";
			       }
		    }
		    if ($this->accountnameuni!='')
		    {
			      if ($cond=='')
			      {
				        $cond="accountnameuni like '%".$this->accountnameuni."%'";
			       }
			       else
			       {
				         $cond=$cond." and accountnameuni like '%".$this->accountnameuni."%'";
			       }
		    }
		    if ($this->groupcode!='' and $this->groupcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="groupcode = ".$this->groupcode;
			       }
			       else
			       {
				         $cond=$cond." and groupcode = ".$this->groupcode;
			       }
		    }
		    if ($this->subgroupcode!='' and $this->subgroupcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="subgroupcode = ".$this->subgroupcode;
			       }
			       else
			       {
				         $cond=$cond." and subgroupcode = ".$this->subgroupcode;
			       }
		    }
		    if ($this->subsubgroupcode!='' and $this->subsubgroupcode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="subsubgroupcode = ".$this->subsubgroupcode;
			       }
			       else
			       {
				         $cond=$cond." and subsubgroupcode = ".$this->subsubgroupcode;
			       }
		    }
		    if ($this->schedulecode!='' and $this->schedulecode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="schedulecode = ".$this->schedulecode;
			       }
			       else
			       {
				         $cond=$cond." and schedulecode = ".$this->schedulecode;
			       }
		    }
		    if ($this->subschedulecode!='' and $this->subschedulecode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="subschedulecode = ".$this->subschedulecode;
			       }
			       else
			       {
				         $cond=$cond." and subschedulecode = ".$this->subschedulecode;
			       }
		    }
		    if ($this->subsubschedulecode!='' and $this->subsubschedulecode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="subsubschedulecode = ".$this->subsubschedulecode;
			       }
			       else
			       {
				         $cond=$cond." and subsubschedulecode = ".$this->subsubschedulecode;
			       }
            }
            if ($this->subsubsubschedulecode!='' and $this->subsubsubschedulecode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="subsubsubschedulecode = ".$this->subsubsubschedulecode;
			       }
			       else
			       {
				         $cond=$cond." and subsubsubschedulecode = ".$this->subsubsubschedulecode;
			       }
		    }
		    if ($this->issubledgerallowed!='' and $this->issubledgerallowed!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="issubledgerallowed = ".$this->issubledgerallowed;
			       }
			       else
			       {
				         $cond=$cond." and issubledgerallowed = ".$this->issubledgerallowed;
			       }
            }
            if ($this->refcode!='')
		    {
			      if ($cond=='')
			      {
				        $cond="refcode = ".$this->refcode;
			       }
			       else
			       {
				         $cond=$cond." and refcode = '".$this->refcode."'";
			       }
            }
            if ($this->isyearcodeallowed!='' and $this->isyearcodeallowed!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="isyearcodeallowed = ".$this->isyearcodeallowed;
			       }
			       else
			       {
				         $cond=$cond." and isyearcodeallowed = '".$this->isyearcodeallowed."'";
			       }
            }
            
        if ($cond!='')
		    {
		        $query = "select * from accounthead where ".$cond." order by accountcode";
			      $result = oci_parse($this->connection, $query);
            $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
			      return $result;
		     }
		     else
		     {
		         $query = "select * from accounthead order by accountcode";
			       $result = oci_parse($this->connection, $query);
             $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
			       return $result;
		     }
	  }
    public function update()
    {
        $this->dataoperationmode = operationmode::Update;
        if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
        $query = "
        update accounthead set 
        accountnameeng =".$this->invl($this->accountnameeng,false)."
        ,accountnameuni =".$this->invl($this->accountnameuni,false)."
        ,groupcode = ".$this->invl($this->groupcode,true)."
        ,subgroupcode = ".$this->invl($this->subgroupcode,true,true)."
        ,subsubgroupcode = ".$this->invl($this->subsubgroupcode,true,true)."
        ,schedulecode = ".$this->invl($this->schedulecode,true,true)."
        ,subschedulecode = ".$this->invl($this->subschedulecode,true,true)."
        ,subsubschedulecode = ".$this->invl($this->subsubschedulecode,true,true)."
        ,subsubsubschedulecode = ".$this->invl($this->subsubsubschedulecode,true,true)."
        ,issubledgerallowed = ".$this->invl($this->issubledgerallowed,true)."
        ,refcode = ".$this->invl($this->refcode,true)."
        ,isyearcodeallowed = ".$this->invl($this->isyearcodeallowed,true)."
        ,isdaybookdetaildisplay = ".$this->invl($this->isdaybookdetaildisplay,true)."
        ,isvoucherdetaildisplay = ".$this->invl($this->isvoucherdetaildisplay,true)."
        where 
        accountcode = ".$this->invl($this->accountcode,true)."
        ";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            return 1;
            exit;
        }
            else
        {
            return 0;
            exit;
        }
    }
    public function delete()
    {
        $this->dataoperationmode = operationmode::Update;
        if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
        $query = "
        delete from accounthead
        where 
        accountcode = ".$this->invl($this->accountcode,true)."
        ";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
             return 1;
             exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function fetch()
    {
        $this->dataoperationmode = operationmode::Select;
        $query = "select 
        accountcode
        ,accountnameeng
        ,accountnameuni
        ,groupcode
        ,subgroupcode
        ,subsubgroupcode
        ,schedulecode
        ,subschedulecode
        ,subsubschedulecode
        ,subsubsubschedulecode
        ,issubledgerallowed
        ,refcode
        ,isyearcodeallowed
        ,isdaybookdetaildisplay
        ,isvoucherdetaildisplay
        from ACCOUNTHEAD where 
        accountcode = ".$this->accountcode."
        ";
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
                $this->accountcode = $row['ACCOUNTCODE'];
                $this->accountnameeng = $row['ACCOUNTNAMEENG'];
                $this->accountnameuni = $row['ACCOUNTNAMEUNI'];
                $this->groupcode = $row['GROUPCODE'];
                $this->subgroupcode = $row['SUBGROUPCODE'];
                $this->subsubgroupcode = $row['SUBSUBGROUPCODE'];
                $this->schedulecode = $row['SCHEDULECODE'];
                $this->subschedulecode = $row['SUBSCHEDULECODE'];
                $this->subsubschedulecode = $row['SUBSUBSCHEDULECODE'];
                $this->subsubsubschedulecode = $row['SUBSUBSUBSCHEDULECODE'];
                $this->issubledgerallowed = $row['ISSUBLEDGERALLOWED'];
                $this->refcode = $row['REFCODE'];
                $this->isyearcodeallowed = $row['ISYEARCODEALLOWED'];
                $this->isdaybookdetaildisplay = $row['ISDAYBOOKDETAILDISPLAY'];
                $this->isvoucherdetaildisplay = $row['ISVOUCHERDETAILDISPLAY'];
                $this->found=true;
                return true;
        }
        else
        {
        return false;
        }
    }
    function issubgroupexists()
    {
        $query = "select count(*) as cnt 
        from accountsubgroup s 
        where s.groupcode = ".$this->invl($this->groupcode,true);
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            if ($row['CNT']>0)
            {
                return 1;
            }
            else
            {
                return 0;
            }
        }
        else
        {
            return 0;
        }
    }

    function issubsubgroupexists()
    {
        $query = "select count(*) as cnt 
        from accountsubsubgroup s 
        where s.groupcode = ".$this->invl($this->groupcode,true).
        " and s.subgroupcode=".$this->invl($this->subgroupcode,true);
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            if ($row['CNT']>0)
            {
                return 1;
            }
            else
            {
                return 0;
            }
        }
        else
        {
            return 0;
        }
    }
    function issubgroupvalid()
    {
        $query = "select count(*) as cnt 
        from accountsubgroup s 
        where s.groupcode = ".$this->invl($this->groupcode,true).
        " and s.subgroupcode=".$this->invl($this->subgroupcode,true);
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            if ($row['CNT']>0)
            {
                return 1;
            }
            else
            {
                return 0;
            }
        }
        else
        {
            return 0;
        }
    }
    function issubsubgroupvalid()
    {
        $query = "select count(*) as cnt 
        from accountsubsubgroup s 
        where s.groupcode = ".$this->invl($this->groupcode,true).
        " and s.subgroupcode=".$this->invl($this->subgroupcode,true).
        " and s.subsubgroupcode=".$this->invl($this->subsubgroupcode,true);
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            if ($row['CNT']>0)
            {
                return 1;
            }
            else
            {
                return 0;
            }
        }
        else
        {
            return 0;
        }
    }

    //
    function issubscheduleexists()
    {
        $query = "select count(*) as cnt 
        from accountsubschedule s 
        where s.schedulecode = ".$this->invl($this->schedulecode,true);
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            if ($row['CNT']>0)
            {
                return 1;
            }
            else
            {
                return 0;
            }
        }
        else
        {
            return 0;
        }
    }

    function issubsubscheduleexists()
    {
        $query = "select count(*) as cnt 
        from accountsubsubschedule s 
        where s.schedulecode = ".$this->invl($this->schedulecode,true).
        " and s.subschedulecode=".$this->invl($this->subschedulecode,true);
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            if ($row['CNT']>0)
            {
                return 1;
            }
            else
            {
                return 0;
            }
        }
        else
        {
            return 0;
        }
    }
    function issubsubsubscheduleexists()
    {
        $query = "select count(*) as cnt 
        from accountsubsubsubschedule s 
        where s.schedulecode = ".$this->invl($this->schedulecode,true).
        " and s.subschedulecode=".$this->invl($this->subschedulecode,true).
        " and s.subsubschedulecode=".$this->invl($this->subsubschedulecode,true)
        ;
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            if ($row['CNT']>0)
            {
                return 1;
            }
            else
            {
                return 0;
            }
        }
        else
        {
            return 0;
        }
    }
    function issubschedulevalid()
    {
        $query = "select count(*) as cnt 
        from accountsubschedule s 
        where s.schedulecode = ".$this->invl($this->schedulecode,true).
        " and s.subschedulecode=".$this->invl($this->subschedulecode,true);
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            if ($row['CNT']>0)
            {
                return 1;
            }
            else
            {
                return 0;
            }
        }
        else
        {
            return 0;
        }
    }
    function issubsubschedulevalid()
    {
        $query = "select count(*) as cnt 
        from accountsubsubschedule s 
        where s.schedulecode = ".$this->invl($this->schedulecode,true).
        " and s.subschedulecode=".$this->invl($this->subschedulecode,true).
        " and s.subsubschedulecode=".$this->invl($this->subsubschedulecode,true);
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            if ($row['CNT']>0)
            {
                return 1;
            }
            else
            {
                return 0;
            }
        }
        else
        {
            return 0;
        }
    }
    function issubsubsubschedulevalid()
    {
        $query = "select count(*) as cnt 
        from accountsubsubsubschedule s 
        where s.schedulecode = ".$this->invl($this->schedulecode,true).
        " and s.subschedulecode=".$this->invl($this->subschedulecode,true).
        " and s.subsubschedulecode=".$this->invl($this->subsubschedulecode,true).
        " and s.subsubsubschedulecode=".$this->invl($this->subsubsubschedulecode,true);
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            if ($row['CNT']>0)
            {
                return 1;
            }
            else
            {
                return 0;
            }
        }
        else
        {
            return 0;
        }
    }
    function isscheduleexists()
    {
        if ($this->subgroupcode=='' or $this->subgroupcode=='0')
        {
            $query = "select count(*) as cnt 
            from accountschedule s 
            where s.groupcode = ".$this->invl($this->groupcode,true);
        }
        else
        {
            $query = "select count(*) as cnt 
            from accountschedule s 
            where s.groupcode = ".$this->invl($this->groupcode,true).
            " and s.subgroupcode = ".$this->invl($this->subgroupcode,true);
        }
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            if ($row['CNT']>0)
            {
                return 1;
            }
            else
            {
                return 0;
            }
        }
        else
        {
            return 0;
        }
    }
    public function verify()
    {
        $query = "select accountcode 
        from accounthead s 
        order by accountcode";
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        while ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            $this->accountcode=$row['ACCOUNTCODE'];
            $this->fetch();
            if ($this->entryvalidation() <> 0)
            {
                echo 'Account code:'.$this->accountcode.'</br>';
                echo $this->invalidmessagetext;
                echo '<li><a class="navbar" href="../ip_view/accounthead.php?accountcode='.fnEncrypt($this->accountcode).'&flag='.$flag_en.'">Find Account Head   </a>';
                return 0;
                exit;
            }
        }
    }
    public function autocodeserialupdate()
    {
        $query = "select accountcode,srno 
        from accounthead s
        order by srno";
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        while ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            $this->accountcode=$row['ACCOUNTCODE'];
            $this->fetch();
            $newaccountcode=$this->nextaccountcode();
            $query1 = "
            update accounthead1 set 
            accountcode =".$this->invl($newaccountcode,true)."
            where 
            srno = ".$this->invl($row['SRNO'],true);
            $result1 = oci_parse($this->connection, $query1);
            if (oci_execute($result1,OCI_NO_AUTO_COMMIT))
            {
                oci_commit($connection);
            }
            else
            {
                return 0;
                exit;
            }
        }
        return 1;
    }
    public function transliteratemartoeng()
    {
        $table="aahar";
        $query = "select code,name,ename 
        from ".$table." s
        where s.ename is null
        order by code";
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        while ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {
            $ename = convertfullnamemar2eng(trim($row['NAME']));
            //$ename = convertfullnamemar2eng('राठोड भगवान दत्तू');
            $engname = $ename['1'].' '.$ename['2'].' '.$ename['3'];
            $query1 = "
            update ".$table." set 
            ename =".$this->invl($engname,false)."
            where 
            code = ".$this->invl($row['CODE'],true);
            $result1 = oci_parse($this->connection, $query1);
            if (oci_execute($result1,OCI_NO_AUTO_COMMIT))
            {
                oci_commit($this->connection);
            }
            else
            {
                oci_rollback($this->connection);
            }
        }
    }

    public function openingbalance($opdate)
    {   
        $query = "select sum(t.debit-t.credit) sopbl
        from vw_account_all_transaction t
        where t.cdate<'".$opdate."' 
        and t.yearperiodcode=".$_SESSION['yearperiodcode']."
        and t.accountcode=".$this->accountcode;
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {  
            return $row['SOPBL'];
        }
        else
        {
        return 0;
        }
    }   

 public function closingbalance($cldate)
    {   
        $query = "select sum(t.debit-t.credit) clbal
        from vw_account_all_transaction t
        where t.cdate<='".$cldate."' 
        and t.yearperiodcode=".$_SESSION['yearperiodcode']."
        and t.accountcode=".$this->accountcode;
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {  
            return $row['CLBAL'];
        }
        else
        {
        return 0;
        }
    }   

    
    public function bdcredit($fdt,$tdt)
    {   
        $query = "select sum(t.credit) credit
        from vw_account_all_transaction t
        where t.cdate>='".$fdt."' 
        and t.cdate<='".$tdt."' 
        and t.yearperiodcode=".$_SESSION['yearperiodcode']."
        and t.accountcode=".$this->accountcode;
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {  
            return $row['CREDIT'];
        }
        else
        {
        return 0;
        }
    }     

     public function bddebit($fdt,$tdt)
    {   
        $query = "select sum(t.debit) debit
        from vw_account_all_transaction t
        where t.cdate>='".$fdt."' 
        and t.cdate<='".$tdt."' 
        and t.yearperiodcode=".$_SESSION['yearperiodcode']."
        and t.accountcode=".$this->accountcode;
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {  
            return $row['DEBIT'];
        }
        else
        {
            return 0;
        }
    }

    public function bdbankcredit($fdt,$tdt)
    {   
        $query = "select sum(t.bank) credit
        from vw_daybook_credit_account_sum t
        where t.voucherdate>='".$fdt."' 
        and t.voucherdate<='".$tdt."' 
        and t.yearperiodcode=".$_SESSION['yearperiodcode'];
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {  
            return $row['CREDIT'];
        }
        else
        {
            return 0;
        }
    }

    public function bdbankdebit($fdt,$tdt)
    {   
        $query = "select sum(t.bank) debit
        from vw_daybook_debit_account_sum t
        where t.voucherdate>='".$fdt."' 
        and t.voucherdate<='".$tdt."' 
        and t.yearperiodcode=".$_SESSION['yearperiodcode'];
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {  
            return $row['DEBIT'];
        }
        else
        {
        return 0;
        }
    }

    public function cashaccountcode()
    {
        $query = "select cashaccountcode from accountcontroltable";
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result,OCI_NO_AUTO_COMMIT);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        {  
            return $row['CASHACCOUNTCODE'];
        }
        else
        {
            return 0;
        }
    }

}
?>

