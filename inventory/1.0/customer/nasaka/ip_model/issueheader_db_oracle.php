<?php
//This is generated by Nigade Software Technologies (opc) Private Limited 12/12/2020 10:19:13 am for PHP
require_once("../swappbase/formbase.php");
class issueheader extends swappform
{
    Public $transactionnumber;
    Public $financialyear;
    Public $issuenumber;
    Public $issueprefixnumber; 
    Public $issuedate;
    Public $issuetypecode;
    Public $issuetypecodetextcombo;
    Public $employeecode;
    Public $issuetosectioncode;
    Public $issuetoemployeecode;
    Public $issuetoemployeecodetextcombo;
    Public $issuetosuppliercode;
    Public $issuetosuppliercodetextcombo;
    Public $capitalexpensescode;
    Public $capitalexpensescodetextcombo;
    Public $purpose;
    public function __construct(&$connection)
    {
     		 parent::__construct($connection);
         $this->transactionnumber='';
         $this->transactionnumbertextcombo='';
         $this->financialyear='';
         $this->financialyeartextcombo='';
         $this->issuenumber='';
         $this->issuenumbertextcombo='';
         $this->issueprefixnumber='';
         $this->issueprefixnumbertextcombo='';
         $this->issuedate='';
         $this->issuedatetextcombo='';
         $this->issuetypecode='';
         $this->issuetypecodetextcombo='';
         $this->employeecode='';
         $this->employeecodetextcombo='';
         $this->issuetosectioncode='';
         $this->issuetosectioncodetextcombo='';
         $this->issuetoemployeecode='';
         $this->issuetoemployeecodetextcombo='';
         $this->issuetosuppliercode='';
         $this->issuetosuppliercodetextcombo='';
         $this->capitalexpensescode='';
         $this->capitalexpensescodetextcombo='';
	   }
    public function entryvalidation()
    {
    		$this->start_validation();
        //$this->checkrequired($this->financialyear,'Financial Year ','आर्थिक वर्ष');
        //$this->checkrequired($this->issuenumber,'Issue Number ','इशू क्रमांक');
        //$this->checkrequired($this->issueprefixnumber,'Issue Prefix Number ','इशू उपसर्ग क्रमांक');
        $this->checkrequired($this->issuedate,'Issue Date ','इशू तारीख');
        $this->checkrequired($this->issuetypecode,'Issue Type Code ','इशू प्रकार कोड');
        //$this->checkrequired($this->employeecode,'Employee Code ','कर्मचारी कोड');
        if ($this->issuetypecode==1)
        {
            $this->checkrequired($this->issuetosectioncode,'Issue to Section Code ','इशू उप विभाग क्रमांक');
            $this->checkrequired($this->capitalexpensescode,'Capital Expenses Code ','भांडवली खर्च कोड');
        }
        elseif ($this->issuetypecode==2)
        $this->checkrequired($this->issuetohtcontractorcode,'Issue to HT Contractor Code ','इशू तो.व.कंत्राटदार');
        //$this->checkrequired($this->issuetoemployeecode,'Issue To Employee Code ','इशू कर्मचारी कोड');
        //$this->checkrequired($this->issuetosuppliercode,'Issue To Supplier Code','इशू पुरवठाकर्ता कोड');
        $this->end_validation();
        return $this->invalidid;
	  }
    private function datavalidation()
    {
        $this->start_validation();
    		$this->invalidid=0;
    		$this->invalidmessagetext='Validated';
    		$this->end_validation();
    		return $this->invalidid;
    }
    public function insert()
    {
        $this->dataoperationmode = operationmode::Insert;
	    if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
        $this->financialyear= $_SESSION['yearperiodcode'];
	    if ($this->transactionnumber == '')
        {
            $query = "select nvl(max(transactionnumber),0)+1 as transactionnumber from issueheader";
            $result = oci_parse($this->connection, $query);
            $r = oci_execute($result);
            $row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
            $this->transactionnumber = $row["TRANSACTIONNUMBER"];
        }
        if ($this->issuenumber == '')
        {
            $query = "select nvl(max(issuenumber),0)+1 as issuenumber from issueheader
            where financialyear=".$_SESSION['yearperiodcode'];
            $result = oci_parse($this->connection, $query);
            $r = oci_execute($result);
            $row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS);
            $this->issuenumber = $row["ISSUENUMBER"];
            $this->issueprefixnumber = $row["ISSUENUMBER"];
        }
        if ($this->issuedate!='')
        {
            $this->issuedate = DateTime::createFromFormat('d/m/Y',$this->issuedate)->format('d-M-Y');
        }
        $query = "
            insert into issueheader(
            transactionnumber
            ,financialyear
            ,issuenumber
            ,issueprefixnumber
            ,issuedate
            ,issuetypecode
            ,employeecode
            ,issuetosectioncode
            ,issuetoemployeecode
            ,issuetosuppliercode
            ,capitalexpensescode
            ,purpose
            ,issuetohtcontractorcode
	        )
	        values (
            ".$this->invl($this->transactionnumber,true)."
            ,".$this->invl($this->financialyear,true)."
            ,".$this->invl($this->issuenumber,true)."
            ,".$this->invl($this->issueprefixnumber,false)."
            ,".$this->invl($this->issuedate,false)."
            ,".$this->invl($this->issuetypecode,true,true)."
            ,".$this->invl($this->employeecode,true)."
            ,".$this->invl($this->issuetosectioncode,true)."
            ,".$this->invl($this->issuetoemployeecode,true,true)."
            ,".$this->invl($this->issuetosuppliercode,true,true)."
            ,".$this->invl($this->capitalexpensescode,true,true)."
            ,".$this->invl($this->purpose,false)."
            ,".$this->invl($this->issuetohtcontractorcode,true,true)."
            )";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            return 1;
            exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function display()
	  {
		    $this->dataoperationmode = operationmode::Select;
		    $cond='';
		    if ($this->transactionnumber!='' and $this->transactionnumber!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.transactionnumber = ".$this->transactionnumber;
			       }
			       else
			       {
				         $cond=$cond." and t.transactionnumber = ".$this->transactionnumber;
			       }
		    }
		    if ($this->issuetypecode!='' and $this->issuetypecode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.issuetypecode = ".$this->issuetypecode;
			       }
			       else
			       {
				         $cond=$cond." and t.issuetypecode = ".$this->issuetypecode;
			       }
		    }
		    if ($this->issuetoemployeecode!='' and $this->issuetoemployeecode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.issuetoemployeecode = ".$this->issuetoemployeecode;
			       }
			       else
			       {
				         $cond=$cond." and t.issuetoemployeecode = ".$this->issuetoemployeecode;
			       }
		    }
		    if ($this->issuetosuppliercode!='' and $this->issuetosuppliercode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.issuetosuppliercode = ".$this->issuetosuppliercode;
			       }
			       else
			       {
				         $cond=$cond." and t.issuetosuppliercode = ".$this->issuetosuppliercode;
			       }
		    }
		    if ($this->capitalexpensescode!='' and $this->capitalexpensescode!=0)
		    {
			      if ($cond=='')
			      {
				        $cond="t.capitalexpensescode = ".$this->capitalexpensescode;
			       }
			       else
			       {
				         $cond=$cond." and t.capitalexpensescode = ".$this->capitalexpensescode;
			       }
		    }
        if ($cond!='')
		    {
		        $query = "
                   select t.transactionnumber
                    ,('Issue No: '||t.issuenumber||' Issue Date:'||To_char(t.issuedate,'dd/MM/yyyy')||' Section: '||s.sectionnameeng)narr
                    from issueheader t,nst_nasaka_payroll.SECTIONMASTER s 
                    where ".$cond." and t.issuetosectioncode=s.sectioncode(+) and financialyear=".$_SESSION['yearperiodcode']."  order by transactionnumber
                  ";
			      $result = oci_parse($this->connection, $query);
            $r = oci_execute($result);
			      return $result;
		     }
		     else
		     {
		         $query = "
                 select t.transactionnumber
                    ,('Issue No: '||t.issuenumber||' Issue Date:'||To_char(t.issuedate,'dd/MM/yyyy')||' Section: '||s.sectionnameeng)narr
                    from issueheader t,nst_nasaka_payroll.SECTIONMASTER s 
                    where t.issuetosectioncode=s.sectioncode(+) and financialyear=".$_SESSION['yearperiodcode']."  order by transactionnumber
                  ";
			       $result = oci_parse($this->connection, $query);
             $r = oci_execute($result);
			       return $result;
		     }
	  }
    public function update()
    {
        $this->dataoperationmode = operationmode::Update;
        if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
        $this->issuedate = DateTime::createFromFormat('d/m/Y',$this->issuedate)->format('d-M-Y');
        $query = "
        update issueheader set 
        issuenumber = ".$this->invl($this->issuenumber,true,true)."
        ,issueprefixnumber =".$this->invl($this->issueprefixnumber,false)."
        ,issuedate =".$this->invl($this->issuedate,false)."
        ,issuetypecode = ".$this->invl($this->issuetypecode,true,true)."
        ,employeecode = ".$this->invl($this->employeecode,true,true)."
        ,issuetosectioncode = ".$this->invl($this->issuetosectioncode,true,true)."
        ,issuetoemployeecode = ".$this->invl($this->issuetoemployeecode,true,true)."
        ,issuetosuppliercode = ".$this->invl($this->issuetosuppliercode,true,true)."
        ,capitalexpensescode = ".$this->invl($this->capitalexpensescode,true,true)."
        ,purpose = ".$this->invl($this->purpose,false)."
        ,issuetohtcontractorcode = ".$this->invl($this->issuetohtcontractorcode,true,true)."
        where 
        transactionnumber = ".$this->invl($this->transactionnumber,true)."
        ";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
            return 1;
            exit;
        }
            else
        {
            return 0;
            exit;
        }
    }
    public function delete()
    {
        $this->dataoperationmode = operationmode::Delete;
        if ($this->entryvalidation() <> 0)
        {
            return 0;
            exit;
        }
        elseif ($this->datavalidation() <> 0)
        {
            return 0;
            exit;
        }
        $this->issuedate = DateTime::createFromFormat('d/m/Y',$this->issuedate)->format('d-M-Y');
        $query = "
        delete from issueheader
        where 
        transactionnumber = ".$this->invl($this->transactionnumber,true)."
        ";
        $result = oci_parse($this->connection, $query);
        if (oci_execute($result,OCI_NO_AUTO_COMMIT))
        {
             return 1;
             exit;
        }
        else
        {
            return 0;
            exit;
        }
    }
    public function fetch()
    {
        $this->dataoperationmode = operationmode::Select;
        $query = "select 
        transactionnumber
        ,financialyear
        ,issuenumber
        ,issueprefixnumber
        ,issuedate
        ,issuetypecode
        ,employeecode
        ,issuetosectioncode
        ,issuetoemployeecode
        ,issuetosuppliercode
        ,capitalexpensescode
        ,purpose
        ,issuetohtcontractorcode
        from issueheader where 
        transactionnumber = ".$this->invl($this->transactionnumber,true)."
        ";
        $result = oci_parse($this->connection, $query);
        $r = oci_execute($result);
        if ($row = oci_fetch_array($result,OCI_ASSOC+OCI_RETURN_NULLS))
        { 
                $this->transactionnumber = $row['TRANSACTIONNUMBER'];
                $this->financialyear = $row['FINANCIALYEAR'];
                $this->issuenumber = $row['ISSUENUMBER'];
                $this->issueprefixnumber = $row['ISSUEPREFIXNUMBER'];
                $this->issuedate = DateTime::createFromFormat('d-M-y',$row['ISSUEDATE'])->format('d/m/Y');
                $this->issuetypecode = $row['ISSUETYPECODE'];
                $this->employeecode = $row['EMPLOYEECODE'];
                $this->employeecodetextcombo = $this->textcomboname($connection=$this->connection,$table='nst_nasaka_payroll.EMPLOYEEMASTER',$datafield='EMPLOYEECODE',$datafieldvalue=$row['EMPLOYEECODE'],$engfield='EMPLOYEENAMEENG',$unicodefield='EMPLOYEENAMEUNI');
                $this->issuetosectioncode = $row['ISSUETOSECTIONCODE'];
                $this->issuetoemployeecode = $row['ISSUETOEMPLOYEECODE'];
                $this->issuetosuppliercode = $row['ISSUETOSUPPLIERCODE'];
                $this->capitalexpensescode = $row['CAPITALEXPENSESCODE'];
                $this->capitalexpensescodetextcombo = $this->textcomboname($connection=$this->connection,$table='CAPITALEXPENSES',$datafield='CAPITALEXPENSESCODE',$datafieldvalue=$row['CAPITALEXPENSESCODE'],$engfield='CAPITALEXPENSESNAMEENG',$unicodefield='CAPITALEXPENSESNAMEUNI');
                $this->issuetoemployeecodetextcombo = $this->textcomboname($connection=$this->connection,$table='nst_nasaka_payroll.EMPLOYEEMASTER',$datafield='EMPLOYEECODE',$datafieldvalue=$row['ISSUETOEMPLOYEECODE'],$engfield='EMPLOYEENAMEENG',$unicodefield='EMPLOYEENAMEUNI');
                $this->issuetosuppliercodetextcombo = $this->textcomboname($connection=$this->connection,$table='SUPPLIER',$datafield='SUPPLIERCODE',$datafieldvalue=$row['ISSUETOSUPPLIERCODE'],$engfield='SUPPLIERNAMEENG',$unicodefield='SUPPLIERNAMEUNI');
                $this->issuetypecodetextcombo = $this->textcomboname($connection=$this->connection,$table='ISSUETYPE',$datafield='ISSUETYPECODE',$datafieldvalue=$row['ISSUETYPECODE'],$engfield='ISSUETYPENAMEENG',$unicodefield='ISSUETYPENAMEUNI');
                $this->issuetosectioncodetextcombo = $this->textcomboname($connection=$this->connection,$table='nst_nasaka_payroll.SECTIONMASTER',$datafield='SECTIONCODE',$datafieldvalue=$row['ISSUETOSECTIONCODE'],$engfield='SECTIONNAMEENG',$unicodefield='SECTIONNAMEUNI');
                $this->purpose = $row['PURPOSE'];
                $this->issuetohtcontractorcode = $row['ISSUETOHTCONTRACTORCODE'];
                $this->issuetohtcontractorcodetextcombo = $this->textcomboname($connection=$this->connection,$table='nst_nasaka_agriculture.contractor',$datafield='CONTRACTORCODE',$datafieldvalue=$row['ISSUETOHTCONTRACTORCODE'],$engfield='CONTRACTORNAMEENG',$unicodefield='CONTRACTORNAMEUNI');
                $this->found=true;
                return true;
        }
        else
        {
        return false;
        }
    }
}
?>

